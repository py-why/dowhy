
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>dowhy.datasets &#8212; DoWhy  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=0c6e27e1"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/dowhy/datasets';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="v0.13" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/dowhy-logo-small.png" class="logo__image only-light" alt="DoWhy  documentation - Home"/>
    <img src="../../_static/dowhy-logo-small.png" class="logo__image only-dark pst-js-only" alt="DoWhy  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributing.html">
    Contributing
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../dowhy.html">
    dowhy package
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../code_repo.html">
    Release notes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../dowhy.html">
    dowhy package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../code_repo.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">dowhy.datasets</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for dowhy.datasets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module for generating some sample datasets.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ss</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">choice</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">bernoulli</span><span class="p">,</span> <span class="n">halfnorm</span><span class="p">,</span> <span class="n">poisson</span><span class="p">,</span> <span class="n">uniform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neural_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">MLPRegressor</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.utils.graph_operations</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_edge</span><span class="p">,</span> <span class="n">del_edge</span><span class="p">,</span> <span class="n">get_random_node_pair</span><span class="p">,</span> <span class="n">get_simple_ordered_tree</span>

<span class="n">DISCRETE</span> <span class="o">=</span> <span class="s2">&quot;discrete&quot;</span>
<span class="n">BINARY</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span>
<span class="n">CONTINUOUS</span> <span class="o">=</span> <span class="s2">&quot;continuous&quot;</span>


<div class="viewcode-block" id="sigmoid">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.sigmoid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span></div>



<div class="viewcode-block" id="convert_to_binary">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.convert_to_binary">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_binary</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">stochastic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stochastic</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span></div>



<div class="viewcode-block" id="stochastically_convert_to_three_level_categorical">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.stochastically_convert_to_three_level_categorical">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stochastically_convert_to_three_level_categorical</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">),</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span></div>



<div class="viewcode-block" id="convert_to_categorical">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.convert_to_categorical">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_to_categorical</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">,</span> <span class="n">num_discrete_vars</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">arr_with_dummy</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># Below loop assumes that the last indices of W are alwawys converted to discrete</span>
    <span class="k">for</span> <span class="n">arr_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_discrete_vars</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">):</span>
        <span class="c1"># one-hot encode discrete W</span>
        <span class="n">arr_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="n">arr_index</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">quantiles</span><span class="p">)</span>
        <span class="n">arr_categorical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="n">arr_index</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">arr_bins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">one_hot_encode</span><span class="p">:</span>
            <span class="n">dummy_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">quantiles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="n">arr_categorical</span><span class="p">]</span>
            <span class="n">arr_with_dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">arr_with_dummy</span><span class="p">,</span> <span class="n">dummy_vecs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr_with_dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">arr_with_dummy</span><span class="p">,</span> <span class="n">arr_categorical</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Now deleting the old continuous value</span>
    <span class="k">for</span> <span class="n">arr_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_discrete_vars</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">arr_with_dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">arr_with_dummy</span><span class="p">,</span> <span class="n">arr_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr_with_dummy</span></div>



<div class="viewcode-block" id="construct_col_names">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.construct_col_names">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">construct_col_names</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">,</span> <span class="n">num_discrete_vars</span><span class="p">,</span> <span class="n">num_discrete_levels</span><span class="p">,</span> <span class="n">one_hot_encode</span><span class="p">):</span>
    <span class="n">colnames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_discrete_vars</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">one_hot_encode</span><span class="p">:</span>
        <span class="n">discrete_colnames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_discrete_vars</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_discrete_levels</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="n">colnames</span> <span class="o">+</span> <span class="n">discrete_colnames</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="n">colnames</span> <span class="o">+</span> <span class="p">[(</span><span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span> <span class="o">-</span> <span class="n">num_discrete_vars</span><span class="p">,</span> <span class="n">num_vars</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">colnames</span></div>



<div class="viewcode-block" id="linear_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.linear_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">linear_dataset</span><span class="p">(</span>
    <span class="n">beta</span><span class="p">,</span>
    <span class="n">num_common_causes</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="p">,</span>
    <span class="n">num_instruments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">num_effect_modifiers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">num_treatments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">num_frontdoor_variables</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">treatment_is_category</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">outcome_is_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">stochastic_discretization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">num_discrete_common_causes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">num_discrete_instruments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">num_discrete_effect_modifiers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">stddev_treatment_noise</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">stddev_outcome_noise</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">one_hot_encode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a synthetic dataset with a known effect size.</span>

<span class="sd">    This function generates a pandas dataFrame with num_samples records. The variables follow a naming convention where the first letter indicates its role in the causality graph and then a sequence number.</span>

<span class="sd">    :param beta: coefficient of the treatment(s) (&#39;v?&#39;) in the generating equation of the outcome (&#39;y&#39;).</span>
<span class="sd">    :type beta: int or list/ndarray of length num_treatments of type int</span>
<span class="sd">    :param num_common_causes: Number of variables affecting both the treatment and the outcome [w -&gt; v; w -&gt; y]</span>
<span class="sd">    :type num_common_causes: int</span>
<span class="sd">    :param num_samples: Number of records to generate</span>
<span class="sd">    :type num_samples: int</span>
<span class="sd">    :param num_instruments: Number of instrumental variables  [z -&gt; v], defaults to 0</span>
<span class="sd">    :type num_instruments: int</span>
<span class="sd">    :param num_effect_modifiers: Number of effect modifiers, variables affecting only the outcome [x -&gt; y], defaults to 0</span>
<span class="sd">    :type num_effect_modifiers: int</span>
<span class="sd">    :param num_treatments: Number of treatment variables [v]. By default inferred from the beta argument. When provided, beta is recycled to match num_treatments.</span>
<span class="sd">    :type num_treatments : Union[None, int]</span>
<span class="sd">    :param num_frontdoor_variables : Number of frontdoor mediating variables [v -&gt; FD -&gt; y], defaults to  0</span>
<span class="sd">    :type num_frontdoor_variables: int</span>
<span class="sd">    :param treatment_is_binary: Cannot be True if treatment_is_category is True, defaults to True</span>
<span class="sd">    :type treatment_is_binary: bool</span>
<span class="sd">    :param treatment_is_category: Cannot be True if treatment_is_binary is True, defaults to False</span>
<span class="sd">    :type treatment_is_category: bool</span>
<span class="sd">    :param outcome_is_binary: defaults to False,</span>
<span class="sd">    :type outcome_is_binary: bool</span>
<span class="sd">    :param stochastic_discretization: if False, quartiles are used when discretised variables are specified. They can be hot encoded, defaults True</span>
<span class="sd">    :type stochastic_discretization: bool</span>
<span class="sd">    :param num_discrete_common_causes: Number of discrete common causes of the total num_common_causes, defaults to 0</span>
<span class="sd">    :type num_discrete_common_causes: int</span>
<span class="sd">    :param num_discrete_instruments: Number of discrete instrumental variables of the total num_instruments, defaults to 0</span>
<span class="sd">    :type num_discrete_instruments  : int</span>
<span class="sd">    :param num_discrete_effect_modifiers : Number of discrete effect modifiers of the total effect_modifiers, defaults to 0</span>
<span class="sd">    :type num_discrete_effect_modifiers: int</span>
<span class="sd">    :param stddev_treatment_noise : defaults to 1</span>
<span class="sd">    :type stddev_treatment_noise : float</span>
<span class="sd">    :param stddev_outcome_noise: defaults to 0.01</span>
<span class="sd">    :type stddev_outcome_noise: float</span>
<span class="sd">    :param one_hot_encode: defaults to False</span>
<span class="sd">    :type one_hot_encode: bool</span>

<span class="sd">    :returns: Dictionary with pandas dataFrame and few other metadata variables.</span>
<span class="sd">                        &quot;df&quot;: pd.dataFrame</span>
<span class="sd">                        with num_samples records. The variables follow a naming convention were the first letter indicates its role in the causality graph and then a sequence number.</span>

<span class="sd">                    v variables - are the treatments. They can be binary or continuous. In the case of continuous abs(*beta*) defines thier magnitude;</span>

<span class="sd">                    y - is the outcome variable. The generating equation is,</span>
<span class="sd">                     y = normal(0, stddev_outcome_noise) + t @ beta [where @ is a numpy matrix multiplication allowing for beta be a vector]</span>

<span class="sd">                    W variables - commonly cause both the treatment and the outcome and are iid. if continuous, they are Norm(mu = Unif(-1,1), sigma = 1)</span>

<span class="sd">                    Z variables - Instrument variables. Each one affects all treatments. i.e. if there is one instrument and two treatments then z0-&gt;v0, z0-&gt;v1</span>

<span class="sd">                    X variables - effect modifiers. If continuous, they are Norm(mu = Unif(-1,1), sigma = 1)</span>

<span class="sd">                    FD variables - Front door variables, v0-&gt;FD0-&gt;y</span>

<span class="sd">            &quot;treatment_name&quot;: str/list(str)</span>
<span class="sd">            &quot;outcome_name&quot;: str</span>
<span class="sd">            &quot;common_causes_names&quot;: str/list(str)</span>
<span class="sd">            &quot;instrument_names&quot;: str/list(str)</span>
<span class="sd">            &quot;effect_modifier_names&quot;: str/list(str)</span>
<span class="sd">            &quot;frontdoor_variables_names&quot;: str/list(str)</span>
<span class="sd">            &quot;dot_graph&quot;: dot_graph,</span>
<span class="sd">            &quot;gml_graph&quot;: gml_graph,</span>
<span class="sd">            &quot;ate&quot;: float, the true ate in the dataset</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    Examples</span>
<span class="sd">    ********</span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">            import networkx as nx</span>
<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            import dowhy.datasets</span>

<span class="sd">            def plot_gml(gml_graph):</span>
<span class="sd">                    G = nx.parse_gml(gml_graph)</span>
<span class="sd">                    pos=nx.spring_layout(G)</span>
<span class="sd">                    nx.draw_networkx(G, pos, with_labels=True, node_size=1000, node_color=&quot;darkorange&quot;)</span>
<span class="sd">                    return(plt.show())</span>

<span class="sd">            def describe_synthetic_data(synthetic_data):</span>
<span class="sd">                    if (synthetic_data[&#39;gml_graph&#39;] != None) :</span>
<span class="sd">                    plot_gml(synthetic_data[&quot;gml_graph&quot;])</span>
<span class="sd">                    synthetic_data_df=synthetic_data[&quot;df&quot;]</span>
<span class="sd">                    print(&#39;------- Variables --------&#39;)</span>
<span class="sd">                    print(&#39;Treatment vars:&#39;      , synthetic_data[&#39;treatment_name&#39;])</span>
<span class="sd">                    print(&#39;Outcome vars:&#39;        , synthetic_data[&#39;outcome_name&#39;])</span>
<span class="sd">                    print(&#39;Common causes vars:&#39;  , synthetic_data[&#39;common_causes_names&#39;])</span>
<span class="sd">                    print(&#39;Instrument vars:&#39;     , synthetic_data[&#39;instrument_names&#39;])</span>
<span class="sd">                    print(&#39;Effect Modifier vars:&#39;, synthetic_data[&#39;effect_modifier_names&#39;])</span>
<span class="sd">                    print(&#39;Frontdoor vars:&#39;      , synthetic_data[&#39;frontdoor_variables_names&#39;])</span>
<span class="sd">                    print(&#39;Treatment vars:&#39;, synthetic_data[&#39;outcome_name&#39;])</span>
<span class="sd">                    print(&#39;-------- Corr -------&#39;)</span>
<span class="sd">                    print(synthetic_data_df.corr())</span>
<span class="sd">                    print(&#39;------- Head --------&#39;)</span>
<span class="sd">                    return(synthetic_data_df)</span>

<span class="sd">            # create a dataset with 10 observations one binary treatment and a continuous outcome affected by one common cause</span>
<span class="sd">            synthetic_data = dowhy.datasets.linear_dataset(beta = 100,</span>
<span class="sd">                    num_common_causes = 1,</span>
<span class="sd">                    num_samples =10</span>
<span class="sd">                    )</span>
<span class="sd">            describe_synthetic_data(synthetic_data).head()</span>

<span class="sd">            # Two continuous treatments, no common cause, an instrumental variable and two effect modifiers - linearly added appropriately</span>
<span class="sd">            synthetic_data = dowhy.datasets.linear_dataset(</span>
<span class="sd">                    beta                          = 100,</span>
<span class="sd">                    num_common_causes             = 0,</span>
<span class="sd">                    num_samples                   = 20,</span>
<span class="sd">                    num_instruments               = 1,</span>
<span class="sd">                    num_effect_modifiers          = 2,</span>
<span class="sd">                    num_treatments                = 2,</span>
<span class="sd">                    num_frontdoor_variables       = 0,</span>
<span class="sd">                    treatment_is_binary           = False,</span>
<span class="sd">                    treatment_is_category         = False,</span>
<span class="sd">                    outcome_is_binary             = False,</span>
<span class="sd">                    stochastic_discretization     = True,</span>
<span class="sd">                    num_discrete_common_causes    = 0,</span>
<span class="sd">                    num_discrete_instruments      = 0,</span>
<span class="sd">                    num_discrete_effect_modifiers = 0,</span>
<span class="sd">                    stddev_treatment_noise        = 1,</span>
<span class="sd">                    stddev_outcome_noise          = 0.01,</span>
<span class="sd">                    one_hot_encode                = False</span>
<span class="sd">                    )</span>
<span class="sd">            describe_synthetic_data(synthetic_data).head()</span>

<span class="sd">            # One Hot Encoding</span>
<span class="sd">            synthetic_data = dowhy.datasets.linear_dataset(</span>
<span class="sd">                    beta                          = 100,</span>
<span class="sd">                    num_common_causes             =   2,</span>
<span class="sd">                    num_samples                   =  20,</span>
<span class="sd">                    num_instruments               =   1,</span>
<span class="sd">                    num_effect_modifiers          =   1,</span>
<span class="sd">                    num_treatments                =   1,</span>
<span class="sd">                    num_frontdoor_variables       =   1,</span>
<span class="sd">                    treatment_is_binary           = False,</span>
<span class="sd">                    treatment_is_category         = False,</span>
<span class="sd">                    outcome_is_binary             = False,</span>
<span class="sd">                    stochastic_discretization     = True,</span>
<span class="sd">                    num_discrete_common_causes    = 1, #of the total num_common_causes</span>
<span class="sd">                    num_discrete_instruments      = 1,</span>
<span class="sd">                    num_discrete_effect_modifiers = 1,</span>
<span class="sd">                    stddev_treatment_noise        = 1,</span>
<span class="sd">                    stddev_outcome_noise          = 0.01,</span>
<span class="sd">                    one_hot_encode                = True</span>
<span class="sd">                    )</span>
<span class="sd">                    describe_synthetic_data(synthetic_data).head()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">treatment_is_binary</span> <span class="ow">and</span> <span class="n">treatment_is_category</span><span class="p">)</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">FD</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">cz</span><span class="p">,</span> <span class="n">cfd1</span><span class="p">,</span> <span class="n">cfd2</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">X_with_categorical</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_treatments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_treatments</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">size</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)</span>
    <span class="n">num_cont_common_causes</span> <span class="o">=</span> <span class="n">num_common_causes</span> <span class="o">-</span> <span class="n">num_discrete_common_causes</span>
    <span class="n">num_cont_effect_modifiers</span> <span class="o">=</span> <span class="n">num_effect_modifiers</span> <span class="o">-</span> <span class="n">num_discrete_effect_modifiers</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">range_c1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">range_c2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">)</span>
        <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_common_causes</span><span class="p">))</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cov_mat</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="n">W_with_dummy</span> <span class="o">=</span> <span class="n">convert_to_categorical</span><span class="p">(</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">,</span> <span class="n">num_discrete_common_causes</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span>
        <span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_c1</span><span class="p">,</span> <span class="p">(</span><span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_treatments</span><span class="p">))</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_c2</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">num_instruments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">range_cz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_instruments</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_instruments</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instruments</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Z</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
        <span class="c1"># TODO Ensure that we do not generate weak instruments</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">range_cz</span> <span class="o">-</span> <span class="p">(</span><span class="n">range_cz</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">range_cz</span> <span class="o">+</span> <span class="p">(</span><span class="n">range_cz</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">),</span> <span class="p">(</span><span class="n">num_instruments</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">num_effect_modifiers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">range_ce</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_effect_modifiers</span><span class="p">)</span>
        <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_effect_modifiers</span><span class="p">))</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cov_mat</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="n">X_with_categorical</span> <span class="o">=</span> <span class="n">convert_to_categorical</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span>
            <span class="n">num_effect_modifiers</span><span class="p">,</span>
            <span class="n">num_discrete_effect_modifiers</span><span class="p">,</span>
            <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
            <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ce</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_ce</span><span class="p">,</span> <span class="n">X_with_categorical</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># TODO - test all our methods with random noise added to covariates (instead of the stochastic treatment assignment)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stddev_treatment_noise</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">W_with_dummy</span> <span class="o">@</span> <span class="n">c1</span>  <span class="c1"># + np.random.normal(0, 0.01)</span>
    <span class="k">if</span> <span class="n">num_instruments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">Z</span> <span class="o">@</span> <span class="n">cz</span>
    <span class="c1"># Converting treatment to binary if required</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">treatment_is_category</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">stochastically_convert_to_three_level_categorical</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># Generating frontdoor variables if asked for</span>
    <span class="k">if</span> <span class="n">num_frontdoor_variables</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">range_cfd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">range_cfd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">cfd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_cfd1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_treatments</span><span class="p">,</span> <span class="n">num_frontdoor_variables</span><span class="p">))</span>
        <span class="n">cfd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_cfd2</span><span class="p">,</span> <span class="n">num_frontdoor_variables</span><span class="p">)</span>
        <span class="n">FD_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_frontdoor_variables</span><span class="p">))</span>
        <span class="n">FD</span> <span class="o">=</span> <span class="n">FD_noise</span>
        <span class="n">FD</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">@</span> <span class="n">cfd1</span>
        <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">range_c1_frontdoor</span> <span class="o">=</span> <span class="n">range_c1</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">c1_frontdoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_c1_frontdoor</span><span class="p">,</span> <span class="p">(</span><span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_frontdoor_variables</span><span class="p">))</span>
            <span class="n">FD</span> <span class="o">+=</span> <span class="n">W_with_dummy</span> <span class="o">@</span> <span class="n">c1_frontdoor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">FD</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">cfd2</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_frontdoor_variables</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">FD</span> <span class="o">@</span> <span class="n">cfd2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: We are assuming a linear relationship *even when t is categorical* and integer coded.</span>
            <span class="c1"># For categorical t, this example dataset has the effect size for category 2 being exactly</span>
            <span class="c1"># double the effect for category 1</span>
            <span class="c1"># This could be changed at this stage by one-hot encoding t and using a custom beta that</span>
            <span class="c1"># sets a different effect for each category {0, 1, 2}</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">@</span> <span class="n">beta</span>
        <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">W</span> <span class="o">@</span> <span class="n">c2</span>
        <span class="k">if</span> <span class="n">num_effect_modifiers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">ce</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">y</span><span class="p">,</span> <span class="n">stochastic_discretization</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">X_with_categorical</span><span class="p">,</span> <span class="n">FD</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">cfd2</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_instruments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_effect_modifiers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X_with_categorical</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_frontdoor_variables</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">FD</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Computing ATE</span>
    <span class="n">FD_T1</span><span class="p">,</span> <span class="n">FD_T0</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_frontdoor_variables</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">FD_T1</span> <span class="o">=</span> <span class="n">FD_noise</span> <span class="o">+</span> <span class="p">(</span><span class="n">T1</span> <span class="o">@</span> <span class="n">cfd1</span><span class="p">)</span>
        <span class="n">FD_T0</span> <span class="o">=</span> <span class="n">FD_noise</span> <span class="o">+</span> <span class="p">(</span><span class="n">T0</span> <span class="o">@</span> <span class="n">cfd1</span><span class="p">)</span>
    <span class="n">ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">_compute_y</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">X_with_categorical</span><span class="p">,</span> <span class="n">FD_T1</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">cfd2</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">X_with_categorical</span><span class="p">,</span> <span class="n">FD_T0</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">cfd2</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">treatments</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)]</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
    <span class="c1"># constructing column names for one-hot encoded discrete features</span>
    <span class="n">common_causes</span> <span class="o">=</span> <span class="n">construct_col_names</span><span class="p">(</span>
        <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">,</span> <span class="n">num_discrete_common_causes</span><span class="p">,</span> <span class="n">num_discrete_levels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span>
    <span class="p">)</span>
    <span class="n">instruments</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Z&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_instruments</span><span class="p">)]</span>
    <span class="n">frontdoor_variables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;FD&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_frontdoor_variables</span><span class="p">)]</span>
    <span class="n">effect_modifiers</span> <span class="o">=</span> <span class="n">construct_col_names</span><span class="p">(</span>
        <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">num_effect_modifiers</span><span class="p">,</span> <span class="n">num_discrete_effect_modifiers</span><span class="p">,</span> <span class="n">num_discrete_levels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span>
    <span class="p">)</span>
    <span class="n">other_variables</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">frontdoor_variables</span> <span class="o">+</span> <span class="n">effect_modifiers</span> <span class="o">+</span> <span class="n">instruments</span> <span class="o">+</span> <span class="n">common_causes</span> <span class="o">+</span> <span class="n">treatments</span> <span class="o">+</span> <span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_names</span><span class="p">)</span>
    <span class="c1"># Specifying the correct dtypes</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">treatment_is_category</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">outcome</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_discrete_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">one_hot_encode</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">wname</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span> <span class="k">for</span> <span class="n">wname</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">[</span><span class="n">num_cont_common_causes</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">wname</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span> <span class="k">for</span> <span class="n">wname</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">[</span><span class="n">num_cont_common_causes</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_discrete_effect_modifiers</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">one_hot_encode</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">emodname</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span> <span class="k">for</span> <span class="n">emodname</span> <span class="ow">in</span> <span class="n">effect_modifiers</span><span class="p">[</span><span class="n">num_cont_effect_modifiers</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="p">{</span><span class="n">emodname</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span> <span class="k">for</span> <span class="n">emodname</span> <span class="ow">in</span> <span class="n">effect_modifiers</span><span class="p">[</span><span class="n">num_cont_effect_modifiers</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="c1"># Now specifying the corresponding graph strings</span>
    <span class="n">dot_graph</span> <span class="o">=</span> <span class="n">create_dot_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="p">,</span> <span class="n">frontdoor_variables</span><span class="p">)</span>
    <span class="c1"># Now writing the gml graph</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">create_gml_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="p">,</span> <span class="n">frontdoor_variables</span><span class="p">)</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="s2">&quot;treatment_name&quot;</span><span class="p">:</span> <span class="n">treatments</span><span class="p">,</span>
        <span class="s2">&quot;outcome_name&quot;</span><span class="p">:</span> <span class="n">outcome</span><span class="p">,</span>
        <span class="s2">&quot;common_causes_names&quot;</span><span class="p">:</span> <span class="n">common_causes</span><span class="p">,</span>
        <span class="s2">&quot;instrument_names&quot;</span><span class="p">:</span> <span class="n">instruments</span><span class="p">,</span>
        <span class="s2">&quot;effect_modifier_names&quot;</span><span class="p">:</span> <span class="n">effect_modifiers</span><span class="p">,</span>
        <span class="s2">&quot;frontdoor_variables_names&quot;</span><span class="p">:</span> <span class="n">frontdoor_variables</span><span class="p">,</span>
        <span class="s2">&quot;dot_graph&quot;</span><span class="p">:</span> <span class="n">dot_graph</span><span class="p">,</span>
        <span class="s2">&quot;gml_graph&quot;</span><span class="p">:</span> <span class="n">gml_graph</span><span class="p">,</span>
        <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="n">ate</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret_dict</span></div>



<div class="viewcode-block" id="simple_iv_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.simple_iv_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">simple_iv_dataset</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outcome_is_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple instrumental variable dataset with a single IV and a single confounder.&quot;&quot;&quot;</span>
    <span class="n">W</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="n">num_instruments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">num_common_causes</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_treatments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_treatments</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">size</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_common_causes</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">)</span>
    <span class="n">range_cz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>  <span class="c1"># cz is much higher than c1 and c2</span>
    <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
        <span class="n">range_cz</span> <span class="o">-</span> <span class="p">(</span><span class="n">range_cz</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">range_cz</span> <span class="o">+</span> <span class="p">(</span><span class="n">range_cz</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">),</span> <span class="p">(</span><span class="n">num_instruments</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">))</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_instruments</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span> <span class="o">+</span> <span class="n">Z</span> <span class="o">@</span> <span class="n">cz</span> <span class="o">+</span> <span class="n">W</span> <span class="o">@</span> <span class="n">c1</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">W</span> <span class="o">@</span> <span class="n">c2</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>

    <span class="c1"># creating data frame</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">treatments</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)]</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
    <span class="n">common_causes</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;W&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">)]</span>
    <span class="n">ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">_compute_y</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)),</span> <span class="n">W</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)),</span> <span class="n">W</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">instruments</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Z&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_instruments</span><span class="p">)]</span>
    <span class="n">other_variables</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">instruments</span> <span class="o">+</span> <span class="n">common_causes</span> <span class="o">+</span> <span class="n">treatments</span> <span class="o">+</span> <span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_names</span><span class="p">)</span>

    <span class="c1"># Specifying the correct dtypes</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">outcome</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Now specifying the corresponding graph strings</span>
    <span class="n">dot_graph</span> <span class="o">=</span> <span class="n">create_dot_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">)</span>
    <span class="c1"># Now writing the gml graph</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">create_gml_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">)</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="s2">&quot;treatment_name&quot;</span><span class="p">:</span> <span class="n">treatments</span><span class="p">,</span>
        <span class="s2">&quot;outcome_name&quot;</span><span class="p">:</span> <span class="n">outcome</span><span class="p">,</span>
        <span class="s2">&quot;common_causes_names&quot;</span><span class="p">:</span> <span class="n">common_causes</span><span class="p">,</span>
        <span class="s2">&quot;instrument_names&quot;</span><span class="p">:</span> <span class="n">instruments</span><span class="p">,</span>
        <span class="s2">&quot;effect_modifier_names&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;dot_graph&quot;</span><span class="p">:</span> <span class="n">dot_graph</span><span class="p">,</span>
        <span class="s2">&quot;gml_graph&quot;</span><span class="p">:</span> <span class="n">gml_graph</span><span class="p">,</span>
        <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="n">ate</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret_dict</span></div>



<div class="viewcode-block" id="create_dot_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.create_dot_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_dot_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="o">=</span><span class="p">[],</span> <span class="n">frontdoor_variables</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">dot_graph</span> <span class="o">=</span> <span class="s2">&quot;digraph {&quot;</span>
    <span class="k">for</span> <span class="n">currt</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frontdoor_variables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-&gt;</span><span class="si">{1}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currt</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
        <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">currt</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">])</span>
        <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">currt</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">])</span>
        <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">currt</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">])</span>

    <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">outcome</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">])</span>
    <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">outcome</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">effect_modifiers</span><span class="p">])</span>
    <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">outcome</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">])</span>
    <span class="n">dot_graph</span> <span class="o">=</span> <span class="n">dot_graph</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
    <span class="c1"># Adding edges between common causes and the frontdoor mediator</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">:</span>
        <span class="n">dot_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v1</span> <span class="o">+</span> <span class="s2">&quot;-&gt; &quot;</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dot_graph</span></div>



<div class="viewcode-block" id="create_gml_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.create_gml_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_gml_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">effect_modifiers</span><span class="o">=</span><span class="p">[],</span> <span class="n">frontdoor_variables</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;graph[directed 1&quot;</span> <span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>

    <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">])</span>
    <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">])</span>
    <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">currt</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
        <span class="n">gml_graph</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frontdoor_variables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s1">&#39;edge[source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currt</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
        <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">currt</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">])</span>
        <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">currt</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">])</span>
        <span class="n">gml_graph</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currt</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">])</span>

    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">gml_graph</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">])</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">gml_graph</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;node[ id &quot;</span><span class="si">{0}</span><span class="s1">&quot; label &quot;</span><span class="si">{0}</span><span class="s1">&quot;] edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">effect_modifiers</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">gml_graph</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">:</span>
        <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">gml_graph</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;edge[ source &quot;</span><span class="si">{0}</span><span class="s1">&quot; target &quot;</span><span class="si">{1}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">frontdoor_variables</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">gml_graph</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
    <span class="k">return</span> <span class="n">gml_graph</span></div>



<div class="viewcode-block" id="xy_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.xy_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">xy_dataset</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">effect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_linear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sd_error</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">treatment</span> <span class="o">=</span> <span class="s2">&quot;Treatment&quot;</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="s2">&quot;Outcome&quot;</span>
    <span class="n">common_causes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_common_causes</span><span class="p">)]</span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>
    <span class="c1"># Error terms</span>
    <span class="n">E1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sd_error</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">E2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sd_error</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">[</span><span class="n">S</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span>
    <span class="n">T2</span><span class="p">[</span><span class="n">S</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">W0</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">+</span> <span class="n">T2</span>  <span class="c1"># hidden confounder</span>
    <span class="n">tterm</span><span class="p">,</span> <span class="n">yterm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_common_causes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_common_causes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">otherW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cov_mat</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">otherW</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">otherW</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">tterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">otherW</span> <span class="o">@</span> <span class="n">c1</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yterm</span> <span class="o">=</span> <span class="p">(</span><span class="n">otherW</span> <span class="o">@</span> <span class="n">c2</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_linear</span><span class="p">:</span>
        <span class="n">V</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span> <span class="o">+</span> <span class="n">tterm</span> <span class="o">+</span> <span class="n">E1</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span> <span class="o">+</span> <span class="n">yterm</span> <span class="o">+</span> <span class="n">E2</span>  <span class="c1"># + (V-8)*(V-8)</span>
        <span class="k">if</span> <span class="n">effect</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">+=</span> <span class="n">V</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">V</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span> <span class="o">*</span> <span class="n">W0</span> <span class="o">+</span> <span class="n">tterm</span> <span class="o">+</span> <span class="n">E1</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span> <span class="o">*</span> <span class="n">W0</span> <span class="o">+</span> <span class="n">yterm</span> <span class="o">+</span> <span class="n">E2</span>  <span class="c1"># + (V-8)*(V-8)</span>
        <span class="k">if</span> <span class="n">effect</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">+=</span> <span class="n">V</span>  <span class="c1"># /20 # divide by 10 to scale the value of Y to be comparable to V</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">W0</span>
    <span class="c1"># else:</span>
    <span class="c1">#    V = 6 + W0 + tterm + E1</span>
    <span class="c1">#    Y = 12 + W0*W0 + W0*W0 + yterm + E2  # E2_new</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="p">{</span><span class="n">treatment</span><span class="p">:</span> <span class="n">V</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Y</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">W0</span><span class="p">,</span> <span class="n">time_var</span><span class="p">:</span> <span class="n">S</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">otherW</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">dat</span><span class="p">[</span><span class="n">common_causes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">otherW</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="s2">&quot;treatment_name&quot;</span><span class="p">:</span> <span class="n">treatment</span><span class="p">,</span>
        <span class="s2">&quot;outcome_name&quot;</span><span class="p">:</span> <span class="n">outcome</span><span class="p">,</span>
        <span class="s2">&quot;common_causes_names&quot;</span><span class="p">:</span> <span class="n">common_causes</span><span class="p">,</span>
        <span class="s2">&quot;time_val&quot;</span><span class="p">:</span> <span class="n">time_var</span><span class="p">,</span>
        <span class="s2">&quot;instrument_names&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;dot_graph&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;gml_graph&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret_dict</span></div>



<div class="viewcode-block" id="create_discrete_column">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.create_discrete_column">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_discrete_column</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">std_dev</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Generating a random normal distribution of integers</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">xU</span><span class="p">,</span> <span class="n">xL</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">xU</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std_dev</span><span class="p">)</span> <span class="o">-</span> <span class="n">ss</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span>
        <span class="n">xL</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std_dev</span>
    <span class="p">)</span>  <span class="c1"># probability of selecting a number x is p(x-0.5 &lt; x &lt; x+0.5) where x is a normal random variable with mean 0 and standard deviation std_dev</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">prob</span> <span class="o">/</span> <span class="n">prob</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># normalize the probabilities so their sum is 1</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prob</span><span class="p">)</span>  <span class="c1"># pick up an element</span>
    <span class="k">return</span> <span class="n">nums</span></div>



<div class="viewcode-block" id="convert_continuous_to_discrete">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.convert_continuous_to_discrete">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_continuous_to_discrete</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>



<div class="viewcode-block" id="generate_random_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.generate_random_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_random_graph</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to generate random Directed Acyclic Graph</span>
<span class="sd">    :param n: number of nodes in the graph</span>
<span class="sd">    :param max_iter: number of iterations to create graph</span>

<span class="sd">    :returns: Directed Acyclic Graph</span>
<span class="sd">    See: https://datascience.oneoffcoder.com/generate-random-bbn.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">get_simple_ordered_tree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">get_random_node_pair</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">del_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">g</span></div>



<span class="c1"># Given a graph and a dictionary specifying the value type of the nodes in the graph</span>
<span class="c1"># (e.g. &#39;continuous&#39;, &#39;discrete&#39;, or &#39;binary&#39;), verify that the dictionary fully specifies</span>
<span class="c1"># the value type for all notes in the graph.</span>
<div class="viewcode-block" id="check_all_node_types_are_specified">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.check_all_node_types_are_specified">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_all_node_types_are_specified</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">variable_type_dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable_type_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; is not present in variable_type_dict&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">CONTINUOUS</span><span class="p">,</span> <span class="n">DISCRETE</span><span class="p">,</span> <span class="n">BINARY</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; does not have a valid value type in variable_type_dict&quot;</span><span class="p">)</span></div>



<span class="c1"># If the treatments are the only non-continuous variables in the graph, and the data is &#39;linear&#39;,</span>
<span class="c1"># then the exact ATE can be computed based on the graph weights.</span>
<div class="viewcode-block" id="exact_ate_of_linear_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.exact_ate_of_linear_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">exact_ate_of_linear_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
    <span class="n">ate</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">all_simple_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">treatment</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">outcome</span><span class="p">):</span>
            <span class="n">path_multiplier</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">graph</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing edge weight from &#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">path_multiplier</span> <span class="o">*=</span> <span class="n">graph</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
            <span class="n">ate</span> <span class="o">+=</span> <span class="n">path_multiplier</span>
    <span class="k">return</span> <span class="n">ate</span></div>



<div class="viewcode-block" id="linear_dataset_from_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.linear_dataset_from_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">linear_dataset_from_graph</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">treatments</span><span class="p">,</span>
    <span class="n">outcome</span><span class="p">,</span>
    <span class="n">treatments_are_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">outcome_is_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">variable_type_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a random dataset given a graph plus a specification for the datatype of</span>
<span class="sd">    the variables in the graph (discrete, continuous, etc.).</span>
<span class="sd">    It models the variables linearly according to the relations in the graph.</span>

<span class="sd">    :param graph: A causal DAG giving the relationship between the variables</span>
<span class="sd">    :param treatments: The treatment variables we are measuring the effect of</span>
<span class="sd">    :param outcome: The outcome variable we are measuring the effect on</span>
<span class="sd">    :param treatments_are_binary: Indicates whether the treatment variables should be binary</span>
<span class="sd">    :param outcome_is_binary: Indicates whether the outcome variable should be binary</span>
<span class="sd">    :param variable_type_dict : An optional dictionary giving the data-type of all the variables in the graph.</span>
<span class="sd">    Keys in the dictionary are nodes in the graph, and values must be in [&quot;discrete&quot;, &quot;binary&quot;, &quot;continuous&quot;].</span>
<span class="sd">    Leave as None unless all nodes are specified; this argument is for the case where specifying the data type of the</span>
<span class="sd">    treatments and outcome is not enough.</span>
<span class="sd">    :param num_samples: Number of samples in the dataset</span>
<span class="sd">    :returns ret_dict : dictionary with information like dataframe, outcome, treatment, graph string and continuous, discrete and binary columns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set variable_type_dict based on given method parameters</span>
    <span class="k">if</span> <span class="n">variable_type_dict</span><span class="p">:</span>
        <span class="n">check_all_node_types_are_specified</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">variable_type_dict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">variable_type_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">CONTINUOUS</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">treatments_are_binary</span><span class="p">:</span>
            <span class="n">variable_type_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">node</span><span class="p">:</span> <span class="n">BINARY</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
            <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">BINARY</span>
    <span class="c1"># Randomly assign edge weights</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">graph</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># This method computes the df, with an option to intervene</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_y</span><span class="p">(</span><span class="n">intervene</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">all_nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">discrete_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">continuous_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">binary_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
            <span class="n">changed</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">currset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Generating data for nodes which have no incoming edges</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
            <span class="c1"># If intervening, set treatment nodes</span>
            <span class="k">if</span> <span class="n">intervene</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">intervene</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Otherwise, only set source nodes</span>
            <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">DISCRETE</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_discrete_column</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>  <span class="c1"># Generating discrete data</span>
                    <span class="n">discrete_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">CONTINUOUS</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>  <span class="c1"># Generating continuous data</span>
                    <span class="n">continuous_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">nums</span><span class="p">)</span>  <span class="c1"># Generating binary data</span>
                    <span class="n">discrete_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">binary_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">successors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>  <span class="c1"># Storing immediate successors for next level data generation</span>
                <span class="n">successors</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">currset</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">successors</span><span class="p">)</span>
                <span class="n">changed</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># &quot;currset&quot; variable currently has all the successors of the nodes which had no incoming edges</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">currset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># Variable to store immediate children of nodes present in &quot;currset&quot;</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">currset</span><span class="p">:</span>
                <span class="n">predecessors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="p">)</span>  <span class="c1"># Getting all the parent nodes on which current &quot;node&quot; depends on</span>
                <span class="k">if</span> <span class="n">changed</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">changed</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predecessors</span>
                <span class="p">):</span>  <span class="c1"># Check if current &quot;node&quot; has not been processed yet and if all the parent nodes have been processed</span>
                    <span class="n">successors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                    <span class="n">successors</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="n">cs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">successors</span><span class="p">)</span>  <span class="c1"># Storing immediate children for next level data generation</span>
                    <span class="n">changed</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">intervene</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">intervene</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">X_observed</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">predecessors</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>  <span class="c1"># Using parent nodes data</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">graph</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">predecessors</span><span class="p">])</span>
                    <span class="n">t_observed</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span> <span class="o">+</span> <span class="n">X_observed</span> <span class="o">@</span> <span class="n">c</span>
                    <span class="p">)</span>  <span class="c1"># Using Linear Regression to generate data</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">DISCRETE</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_continuous_to_discrete</span><span class="p">(</span><span class="n">t_observed</span><span class="p">)</span>
                        <span class="n">discrete_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">CONTINUOUS</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_observed</span>
                        <span class="n">continuous_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># nums = np.random.normal(0, 1, num_samples)</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">t_observed</span><span class="p">)</span>
                        <span class="n">discrete_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                        <span class="n">binary_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">currset</span> <span class="o">=</span> <span class="n">cs</span>

        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">continuous_cols</span><span class="p">,</span> <span class="n">discrete_cols</span><span class="p">,</span> <span class="n">binary_cols</span>

    <span class="n">df</span><span class="p">,</span> <span class="n">continuous_cols</span><span class="p">,</span> <span class="n">discrete_cols</span><span class="p">,</span> <span class="n">binary_cols</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">()</span>

    <span class="c1"># Compute ATE:</span>
    <span class="c1"># If all non-treatment variables are continuous, then can be computed from the</span>
    <span class="c1"># graph directly</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">variable_type_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">CONTINUOUS</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">variable_type_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">):</span>
        <span class="n">ate</span> <span class="o">=</span> <span class="n">exact_ate_of_linear_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Compute empirical ATE estimate</span>
        <span class="n">df_treated</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">intervene</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_untreated</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">intervene</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_treated</span><span class="p">[</span><span class="n">outcome</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_untreated</span><span class="p">[</span><span class="n">outcome</span><span class="p">])</span>

    <span class="n">gml_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">generate_gml</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
        <span class="s2">&quot;outcome_name&quot;</span><span class="p">:</span> <span class="n">outcome</span><span class="p">,</span>
        <span class="s2">&quot;treatment_name&quot;</span><span class="p">:</span> <span class="n">treatments</span><span class="p">,</span>
        <span class="s2">&quot;gml_graph&quot;</span><span class="p">:</span> <span class="n">gml_str</span><span class="p">,</span>
        <span class="s2">&quot;discrete_columns&quot;</span><span class="p">:</span> <span class="n">discrete_cols</span><span class="p">,</span>
        <span class="s2">&quot;continuous_columns&quot;</span><span class="p">:</span> <span class="n">continuous_cols</span><span class="p">,</span>
        <span class="s2">&quot;binary_columns&quot;</span><span class="p">:</span> <span class="n">binary_cols</span><span class="p">,</span>
        <span class="s2">&quot;ate_estimate&quot;</span><span class="p">:</span> <span class="n">ate</span><span class="p">,</span>
        <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="n">ate</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret_dict</span></div>



<div class="viewcode-block" id="dataset_from_random_graph">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.dataset_from_random_graph">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dataset_from_random_graph</span><span class="p">(</span>
    <span class="n">num_vars</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">prob_edge</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prob_type_of_data</span><span class="o">=</span><span class="p">(</span><span class="mf">0.333</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span> <span class="mf">0.334</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a dataset with discrete and continuous kinds of variables.</span>
<span class="sd">    It creates a random graph and models the variables linearly according to the relations in the graph.</span>

<span class="sd">    :param num_vars: Number of variables in the dataset</span>
<span class="sd">    :param num_samples: Number of samples in the dataset</span>
<span class="sd">    :param prob_edge : Probability of an edge between two random nodes in a graph</span>
<span class="sd">    :param random_seed: Seed for generating random graph</span>
<span class="sd">    :param prob_type_of_data : 3-element tuple containing the probability of data being discrete, binary and continuous respectively.</span>
<span class="sd">    :returns ret_dict : dictionary with information like dataframe, outcome, treatment, graph string and continuous, discrete and binary columns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">prob_type_of_data</span><span class="p">))</span> <span class="o">==</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">random_seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="n">DAG</span> <span class="o">=</span> <span class="n">generate_random_graph</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">num_vars</span><span class="p">)</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">))</span>
    <span class="n">DAG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
    <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DAG</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">all_nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">num_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>
    <span class="n">random_numbers_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>

    <span class="c1"># Get treatments and outcomes</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">DAG</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">node</span>  <span class="c1"># Node which has no successors is outcome</span>
            <span class="k">break</span>

    <span class="n">treatments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">DAG</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DAG</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">treatments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>  <span class="c1"># Node which causes outcome is treatment</span>

    <span class="c1"># Build variable type dict</span>
    <span class="n">variable_type_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">random_numbers_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">prob_type_of_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">DISCRETE</span>
        <span class="k">elif</span> <span class="n">random_numbers_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">prob_type_of_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">prob_type_of_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONTINUOUS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable_type_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">BINARY</span>

    <span class="k">return</span> <span class="n">linear_dataset_from_graph</span><span class="p">(</span>
        <span class="n">DAG</span><span class="p">,</span> <span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">variable_type_dict</span><span class="o">=</span><span class="n">variable_type_dict</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="partially_linear_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.partially_linear_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">partially_linear_dataset</span><span class="p">(</span>
    <span class="n">beta</span><span class="p">,</span>
    <span class="n">num_common_causes</span><span class="p">,</span>
    <span class="n">num_unobserved_common_causes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">strength_unobserved_confounding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">num_treatments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">treatment_is_category</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">outcome_is_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">stochastic_discretization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">num_discrete_common_causes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">stddev_treatment_noise</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">stddev_outcome_noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">one_hot_encode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">training_sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">treatment_is_binary</span> <span class="ow">and</span> <span class="n">treatment_is_category</span><span class="p">)</span>
    <span class="n">num_outcomes</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_treatments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_treatments</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">size</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)</span>
    <span class="n">num_cont_common_causes</span> <span class="o">=</span> <span class="n">num_common_causes</span> <span class="o">-</span> <span class="n">num_discrete_common_causes</span>

    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">range_c1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">)</span>
        <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_common_causes</span><span class="p">))</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cov_mat</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="n">W_with_dummy</span> <span class="o">=</span> <span class="n">convert_to_categorical</span><span class="p">(</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">,</span> <span class="n">num_discrete_common_causes</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span>
        <span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">range_c1</span><span class="p">,</span> <span class="p">(</span><span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_treatments</span><span class="p">))</span>
        <span class="c1"># assuming that all unobserved common causes are numerical and are not affected by one hot encoding</span>
        <span class="k">if</span> <span class="n">num_unobserved_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c1</span><span class="p">[:</span><span class="n">num_unobserved_common_causes</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[:</span><span class="n">num_unobserved_common_causes</span><span class="p">]</span> <span class="o">*</span> <span class="n">strength_unobserved_confounding</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_unobserved_common_causes</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">strength_unobserved_confounding</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Creating a NN to simulate the nuisance function</span>
    <span class="n">hidden_layer_arch</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">neural_network</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="n">hidden_layer_arch</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">training_sample_size</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">training_sample_size</span><span class="p">,</span> <span class="n">num_outcomes</span><span class="p">)</span>
    <span class="n">neural_network</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stddev_treatment_noise</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="n">T</span> <span class="o">+=</span> <span class="n">W_with_dummy</span> <span class="o">@</span> <span class="n">c1</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">x</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># strength of unobserved confounding</span>
    <span class="n">strength_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">strength_vec</span><span class="p">[:</span><span class="n">num_unobserved_common_causes</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">strength_vec</span><span class="p">[:</span><span class="n">num_unobserved_common_causes</span><span class="p">]</span> <span class="o">*</span> <span class="n">strength_unobserved_confounding</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_unobserved_common_causes</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">strength_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">strength_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">strength_unobserved_confounding</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_y</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">):</span>
        <span class="n">f_x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">T</span> <span class="o">@</span> <span class="n">beta</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">f_x</span>
        <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">convert_to_binary</span><span class="p">)(</span><span class="n">y</span><span class="p">,</span> <span class="n">stochastic_discretization</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">W_with_dummy</span> <span class="o">*</span> <span class="n">strength_vec</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">neural_network</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">num_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Computing ATE</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">))</span>
    <span class="n">ate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">_compute_y</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">neural_network</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">_compute_y</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">W_with_dummy</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">neural_network</span><span class="p">,</span> <span class="n">stddev_outcome_noise</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">treatments</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_treatments</span><span class="p">)]</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
    <span class="n">common_causes</span> <span class="o">=</span> <span class="n">construct_col_names</span><span class="p">(</span>
        <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="p">,</span> <span class="n">num_discrete_common_causes</span><span class="p">,</span> <span class="n">num_discrete_levels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">one_hot_encode</span><span class="o">=</span><span class="n">one_hot_encode</span>
    <span class="p">)</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">common_causes</span> <span class="o">+</span> <span class="n">treatments</span> <span class="o">+</span> <span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_names</span><span class="p">)</span>
    <span class="c1"># Specifying the correct dtypes</span>
    <span class="k">if</span> <span class="n">treatment_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">treatment_is_category</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span> <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatments</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome_is_binary</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">outcome</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_discrete_common_causes</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">one_hot_encode</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">wname</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span> <span class="k">for</span> <span class="n">wname</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">[</span><span class="n">num_cont_common_causes</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">wname</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span> <span class="k">for</span> <span class="n">wname</span> <span class="ow">in</span> <span class="n">common_causes</span><span class="p">[</span><span class="n">num_cont_common_causes</span><span class="p">:]},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dot_graph</span> <span class="o">=</span> <span class="n">create_dot_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="p">[])</span>
    <span class="c1"># Now writing the gml graph</span>
    <span class="n">gml_graph</span> <span class="o">=</span> <span class="n">create_gml_graph</span><span class="p">(</span><span class="n">treatments</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">common_causes</span><span class="p">,</span> <span class="n">instruments</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="s2">&quot;treatment_name&quot;</span><span class="p">:</span> <span class="n">treatments</span><span class="p">,</span>
        <span class="s2">&quot;outcome_name&quot;</span><span class="p">:</span> <span class="n">outcome</span><span class="p">,</span>
        <span class="s2">&quot;common_causes_names&quot;</span><span class="p">:</span> <span class="n">common_causes</span><span class="p">,</span>
        <span class="s2">&quot;dot_graph&quot;</span><span class="p">:</span> <span class="n">dot_graph</span><span class="p">,</span>
        <span class="s2">&quot;gml_graph&quot;</span><span class="p">:</span> <span class="n">gml_graph</span><span class="p">,</span>
        <span class="s2">&quot;ate&quot;</span><span class="p">:</span> <span class="n">ate</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret_dict</span></div>



<div class="viewcode-block" id="lalonde_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.lalonde_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lalonde_dataset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads and returns the Lalonde dataset from https://users.nber.org/~rdehejia/nswdata2.html&quot;&quot;&quot;</span>
    <span class="c1"># The following code for loading the Lalonde dataset was copied from</span>
    <span class="c1"># https://github.com/wayfair/pylift/blob/5afc9088e96f25672423663f5c9b4bb889b4dfc0/examples/Lalonde/Lalonde_sample.ipynb?short_path=b1d451f#L94-L99).</span>
    <span class="c1">#</span>
    <span class="c1"># Copyright 2018, Wayfair, Inc.</span>
    <span class="c1">#</span>
    <span class="c1"># Redistribution and use in source and binary forms, with or without modification, are permitted provided that</span>
    <span class="c1"># the following conditions are met:</span>
    <span class="c1">#</span>
    <span class="c1"># 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the</span>
    <span class="c1">#    following disclaimer.</span>
    <span class="c1">#</span>
    <span class="c1"># 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span>
    <span class="c1">#    following disclaimer in the documentation and/or other materials provided with the distribution.</span>
    <span class="c1">#</span>
    <span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED</span>
    <span class="c1"># WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
    <span class="c1"># PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY</span>
    <span class="c1"># DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
    <span class="c1"># PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
    <span class="c1"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR</span>
    <span class="c1"># OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
    <span class="c1"># DAMAGE.</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;treat&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;educ&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;hisp&quot;</span><span class="p">,</span> <span class="s2">&quot;married&quot;</span><span class="p">,</span> <span class="s2">&quot;nodegr&quot;</span><span class="p">,</span> <span class="s2">&quot;re74&quot;</span><span class="p">,</span> <span class="s2">&quot;re75&quot;</span><span class="p">,</span> <span class="s2">&quot;re78&quot;</span><span class="p">]</span>
    <span class="n">control</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="s2">&quot;https://www.nber.org/~rdehejia/data/nswre74_control.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">cols</span>
    <span class="p">)</span>
    <span class="n">treated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="s2">&quot;https://www.nber.org/~rdehejia/data/nswre74_treated.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">cols</span>
    <span class="p">)</span>
    <span class="n">lalonde</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">control</span><span class="p">,</span> <span class="n">treated</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;treat&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lalonde</span><span class="p">[</span><span class="s2">&quot;u74&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lalonde</span><span class="p">[</span><span class="s2">&quot;re74&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">lalonde</span><span class="p">[</span><span class="s2">&quot;u75&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lalonde</span><span class="p">[</span><span class="s2">&quot;re75&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lalonde</span></div>



<div class="viewcode-block" id="psid_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.psid_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">psid_dataset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads and returns the PSID dataset from https://users.nber.org/~rdehejia/nswdata2.html</span>

<span class="sd">    This is a non-experimental comparison group constructed by Lalonde, consisting</span>
<span class="sd">    entirely of control observations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The following code is a slight modification of</span>
    <span class="c1"># https://github.com/wayfair/pylift/blob/5afc9088e96f25672423663f5c9b4bb889b4dfc0/examples/Lalonde/Lalonde_sample.ipynb?short_path=b1d451f#L94-L99).</span>
    <span class="c1">#</span>
    <span class="c1"># Copyright 2018, Wayfair, Inc.</span>
    <span class="c1">#</span>
    <span class="c1"># Redistribution and use in source and binary forms, with or without modification, are permitted provided that</span>
    <span class="c1"># the following conditions are met:</span>
    <span class="c1">#</span>
    <span class="c1"># 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the</span>
    <span class="c1">#    following disclaimer.</span>
    <span class="c1">#</span>
    <span class="c1"># 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span>
    <span class="c1">#    following disclaimer in the documentation and/or other materials provided with the distribution.</span>
    <span class="c1">#</span>
    <span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED</span>
    <span class="c1"># WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
    <span class="c1"># PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY</span>
    <span class="c1"># DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
    <span class="c1"># PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
    <span class="c1"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR</span>
    <span class="c1"># OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
    <span class="c1"># DAMAGE.</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;treat&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;educ&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;hisp&quot;</span><span class="p">,</span> <span class="s2">&quot;married&quot;</span><span class="p">,</span> <span class="s2">&quot;nodegr&quot;</span><span class="p">,</span> <span class="s2">&quot;re74&quot;</span><span class="p">,</span> <span class="s2">&quot;re75&quot;</span><span class="p">,</span> <span class="s2">&quot;re78&quot;</span><span class="p">]</span>
    <span class="n">psid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://www.nber.org/~rdehejia/data/psid_controls.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="n">psid</span> <span class="o">=</span> <span class="n">psid</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;treat&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">psid</span><span class="p">[</span><span class="s2">&quot;u74&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psid</span><span class="p">[</span><span class="s2">&quot;re74&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">psid</span><span class="p">[</span><span class="s2">&quot;u75&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">psid</span><span class="p">[</span><span class="s2">&quot;re75&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psid</span></div>



<div class="viewcode-block" id="sales_dataset">
<a class="viewcode-back" href="../../dowhy.html#dowhy.datasets.sales_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sales_dataset</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2021-01-01&quot;</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2021-12-31&quot;</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span>
    <span class="n">num_shopping_events</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">original_product_price</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">product_production_cost</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">based_ad_spending</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">change_of_price</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">change_of_demand</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">,</span>
    <span class="n">page_visitor_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a sales dataset based on a single product item with daily data.</span>

<span class="sd">    This closely follows the blog post: https://aws.amazon.com/blogs/opensource/root-cause-analysis-with-dowhy-an-open-source-python-library-for-causal-machine-learning/</span>

<span class="sd">    :param start_date: The starting date for the dataset, formatted as &quot;YYYY-MM-DD&quot;. Default is &quot;2021-01-01&quot;.</span>
<span class="sd">    :param end_date: The ending date for the dataset, formatted as &quot;YYYY-MM-DD&quot;. Default is &quot;2021-12-31&quot;.</span>
<span class="sd">    :param frequency: Frequency for the date range. Default is &quot;d&quot; (daily).</span>
<span class="sd">    :param num_shopping_events: Number of special shopping events. Default is 15.</span>
<span class="sd">    :param original_product_price: The initial price of the product. Default is 1000.</span>
<span class="sd">    :param product_production_cost: Cost of producing one unit of the product. Default is 500.</span>
<span class="sd">    :param based_ad_spending: Base spending on ad campaigns. Default is 1000.</span>
<span class="sd">    :param change_of_price: Factor by which the price changes. For example, a value of 0.9 means a 10% decrease. Default is 1.0.</span>
<span class="sd">    :param change_of_demand: Factor by which the demand changes with a change in price. See</span>
<span class="sd">                             https://en.wikipedia.org/wiki/Price_elasticity_of_demand for more information.</span>
<span class="sd">                             This influences the number of sold units. Default is 1.25.</span>
<span class="sd">    :param page_visitor_factor: A factor to adjust the number of page visits. Default is 1.0.</span>

<span class="sd">    :return: A dataframe containing columns related to sales data. The columns of the dataset are:</span>
<span class="sd">       - Shopping Event?: A binary value indicating whether a special shopping event took place.</span>
<span class="sd">       - Ad Spend: Spending on ad campaigns.</span>
<span class="sd">       - Page Views: Number of visits on the product detail page.</span>
<span class="sd">       - Unit Price: Price of the device, which could vary due to temporary discounts.</span>
<span class="sd">       - Sold Units: Number of sold units.</span>
<span class="sd">       - Revenue: Daily revenue.</span>
<span class="sd">       - Operational Cost: Daily operational expenses.</span>
<span class="sd">       - Profit: Daily profit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shopping_event_col</span> <span class="o">=</span> <span class="s2">&quot;Shopping Event?&quot;</span>
    <span class="n">ad_spend_col</span> <span class="o">=</span> <span class="s2">&quot;Ad Spend&quot;</span>
    <span class="n">page_visit_col</span> <span class="o">=</span> <span class="s2">&quot;Page Views&quot;</span>
    <span class="n">price_col</span> <span class="o">=</span> <span class="s2">&quot;Unit Price&quot;</span>
    <span class="n">units_sold_col</span> <span class="o">=</span> <span class="s2">&quot;Sold Units&quot;</span>
    <span class="n">revenue_col</span> <span class="o">=</span> <span class="s2">&quot;Revenue&quot;</span>
    <span class="n">profit_col</span> <span class="o">=</span> <span class="s2">&quot;Profit&quot;</span>
    <span class="n">date_col</span> <span class="o">=</span> <span class="s2">&quot;Date&quot;</span>
    <span class="n">operation_col</span> <span class="o">=</span> <span class="s2">&quot;Operational Cost&quot;</span>

    <span class="n">days</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
    <span class="n">shopping_events</span> <span class="o">=</span> <span class="n">days</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">days</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">num_shopping_events</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="n">base_price</span> <span class="o">=</span> <span class="n">original_product_price</span> <span class="o">*</span> <span class="n">change_of_price</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">date_col</span><span class="p">:</span> <span class="n">days</span><span class="p">})</span>

    <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shopping_events</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">ad_spend_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">based_ad_spending</span>
        <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">]</span> <span class="o">*</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">])</span> <span class="o">*</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">page_visit_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">poisson</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">10000</span> <span class="o">*</span> <span class="n">page_visitor_factor</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">+</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">5000</span> <span class="o">*</span> <span class="n">page_visitor_factor</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">page_visitor_factor</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">ad_spend_col</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">page_visitor_factor</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">page_visit_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">page_visit_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">price_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">base_price</span>
        <span class="o">+</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">bernoulli</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">price_changes</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">price_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">original_product_price</span>
    <span class="n">demand_changes</span> <span class="o">=</span> <span class="n">price_changes</span> <span class="o">*</span> <span class="n">change_of_demand</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">price_changes</span><span class="p">)</span>
    <span class="n">demand_changes</span><span class="p">[</span><span class="n">price_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">price_changes</span><span class="p">[</span><span class="n">price_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">df</span><span class="p">[</span><span class="n">units_sold_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">poisson</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span>
            <span class="n">mu</span><span class="o">=</span><span class="n">demand_changes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">price_changes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">page_visit_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">shopping_event_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="n">units_sold_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">units_sold_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">revenue_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">price_col</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">units_sold_col</span><span class="p">]</span>

    <span class="n">df</span><span class="p">[</span><span class="n">operation_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="n">ad_spend_col</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">product_production_cost</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">units_sold_col</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">halfnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">profit_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">revenue_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">operation_col</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022, PyWhy contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
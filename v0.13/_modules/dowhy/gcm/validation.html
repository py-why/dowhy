
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>dowhy.gcm.validation &#8212; DoWhy  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=0c6e27e1"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/dowhy/gcm/validation';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="v0.13" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-light" alt="DoWhy  documentation - Home"/>
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-dark pst-js-only" alt="DoWhy  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../dowhy.html">
    dowhy package
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../code_repo.html">
    Release notes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../dowhy.html">
    dowhy package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../code_repo.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">dowhy.gcm.validation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for dowhy.gcm.validation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Contains a method to reject the causal graph and validate causal mechanisms such as post non-linear models.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multitest</span><span class="w"> </span><span class="kn">import</span> <span class="n">multipletests</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.gcm.causal_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">InvertibleStructuralCausalModel</span><span class="p">,</span> <span class="n">validate_causal_graph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.gcm.independence_test</span><span class="w"> </span><span class="kn">import</span> <span class="n">kernel_based</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">DirectedGraph</span><span class="p">,</span> <span class="n">get_ordered_predecessors</span><span class="p">,</span> <span class="n">is_root_node</span>


<div class="viewcode-block" id="RejectionResult">
<a class="viewcode-back" href="../../../dowhy.gcm.html#dowhy.gcm.validation.RejectionResult">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RejectionResult</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">REJECTED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">NOT_REJECTED</span> <span class="o">=</span> <span class="p">(</span><span class="n">auto</span><span class="p">(),)</span></div>



<div class="viewcode-block" id="refute_causal_structure">
<a class="viewcode-back" href="../../../dowhy.gcm.html#dowhy.gcm.validation.refute_causal_structure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">refute_causal_structure</span><span class="p">(</span>
    <span class="n">causal_graph</span><span class="p">:</span> <span class="n">DirectedGraph</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">independence_test</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel_based</span><span class="p">,</span>
    <span class="n">conditional_independence_test</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel_based</span><span class="p">,</span>
    <span class="n">significance_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">fdr_control_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fdr_bh&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">RejectionResult</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates the assumptions in a causal graph against data. To this end, at each node, we test if the node is dependent on each of its parents, and test the local Markov condition.</span>
<span class="sd">    Note that valid local Markov conditions also imply a valid global Markov condition.</span>

<span class="sd">    :param causal_graph: A directed acyclic graph (DAG).</span>
<span class="sd">    :param data: Observations of variables in the DAG.</span>
<span class="sd">    :param independence_test: Independence test to use for checking edge dependencies.</span>
<span class="sd">    :param conditional_independence_test: Conditional independence test to use for checking local Markov condition.</span>
<span class="sd">    :param significance_level: Significance level for (conditional) independence tests.</span>
<span class="sd">    :param fdr_control_method: Method for false discovery rate (FDR) control. For various options, please refer to `this page &lt;https://www.statsmodels.org/dev/generated/statsmodels.stats.multitest.multipletests.html&gt;`_.</span>
<span class="sd">    :return: Outcome of the validation process. The first element of the tuple indicates whether the graph is valid w.r.t. given data, and the second element gives the summary of tests at each node. An example for X-&gt;Y-&gt;Z:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        [True, {&#39;X&#39;: {&#39;local_markov_test&#39;: {}, &#39;edge_dependence_test&#39;: {}},</span>
<span class="sd">                &#39;Y&#39;: {&#39;local_markov_test&#39;: {}, &#39;edge_dependence_test&#39;: {&#39;X&#39;: {&#39;p_value&#39;: 0.5, &#39;fdr_adjusted_p_value&#39;: 0.5, &#39;success&#39;: True}}},</span>
<span class="sd">                &#39;Z&#39;: {&#39;local_markov_test&#39;: {&#39;p_value&#39;: 0.0, &#39;fdr_adjusted_p_value&#39;: 0.5, &#39;success&#39;: False},</span>
<span class="sd">                      &#39;edge_dependence_test&#39;: {&#39;Y&#39;: {&#39;p_value&#39;: 0.5, &#39;fdr_adjusted_p_value&#39;: 0.5, &#39;success&#39;: True}}}}]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_dag_valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">validation_summary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">all_p_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">causal_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">get_ordered_predecessors</span><span class="p">(</span><span class="n">causal_graph</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="n">non_descendants</span> <span class="o">=</span> <span class="n">_get_non_descendants</span><span class="p">(</span><span class="n">causal_graph</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">exclude_parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">lmc_test_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parents</span> <span class="ow">and</span> <span class="n">non_descendants</span><span class="p">:</span>
            <span class="c1"># test local Markov condition, null hypothesis: conditional independence</span>
            <span class="n">lmc_p_value</span> <span class="o">=</span> <span class="n">conditional_independence_test</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">non_descendants</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">parents</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">lmc_test_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p_value</span><span class="o">=</span><span class="n">lmc_p_value</span><span class="p">)</span>
            <span class="n">all_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmc_p_value</span><span class="p">)</span>

        <span class="c1"># test edge dependence, null hypothesis: independence</span>
        <span class="n">edge_dependence_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="n">edge_p_value</span> <span class="o">=</span> <span class="n">independence_test</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">edge_dependence_result</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p_value</span><span class="o">=</span><span class="n">edge_p_value</span><span class="p">)</span>
            <span class="n">all_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge_p_value</span><span class="p">)</span>

        <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">local_markov_test</span><span class="o">=</span><span class="n">lmc_test_result</span><span class="p">,</span> <span class="n">edge_dependence_test</span><span class="o">=</span><span class="n">edge_dependence_result</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fdr_control_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">successes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_p_values</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">significance_level</span>
        <span class="n">adjusted_p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">successes</span><span class="p">))</span>
        <span class="n">adjusted_p_values</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">multipletests_result</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">all_p_values</span><span class="p">,</span> <span class="n">significance_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">fdr_control_method</span><span class="p">)</span>
        <span class="n">successes</span> <span class="o">=</span> <span class="n">multipletests_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">adjusted_p_values</span> <span class="o">=</span> <span class="n">multipletests_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># The order of the p-values added to the list is deterministic.</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">causal_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;p_value&quot;</span> <span class="ow">in</span> <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;local_markov_test&quot;</span><span class="p">]:</span>
            <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;local_markov_test&quot;</span><span class="p">][</span><span class="s2">&quot;fdr_adjusted_p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_p_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;local_markov_test&quot;</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">successes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">is_dag_valid</span> <span class="o">&amp;=</span> <span class="ow">not</span> <span class="n">successes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">get_ordered_predecessors</span><span class="p">(</span><span class="n">causal_graph</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
            <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;edge_dependence_test&quot;</span><span class="p">][</span><span class="n">parent</span><span class="p">][</span><span class="s2">&quot;fdr_adjusted_p_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjusted_p_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">validation_summary</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;edge_dependence_test&quot;</span><span class="p">][</span><span class="n">parent</span><span class="p">][</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">successes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">is_dag_valid</span> <span class="o">&amp;=</span> <span class="n">successes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">is_dag_valid</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RejectionResult</span><span class="o">.</span><span class="n">NOT_REJECTED</span><span class="p">,</span> <span class="n">validation_summary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RejectionResult</span><span class="o">.</span><span class="n">REJECTED</span><span class="p">,</span> <span class="n">validation_summary</span></div>



<div class="viewcode-block" id="refute_invertible_model">
<a class="viewcode-back" href="../../../dowhy.gcm.html#dowhy.gcm.validation.refute_invertible_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">refute_invertible_model</span><span class="p">(</span>
    <span class="n">causal_model</span><span class="p">:</span> <span class="n">InvertibleStructuralCausalModel</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">independence_test</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel_based</span><span class="p">,</span>
    <span class="n">significance_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">fdr_control_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RejectionResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the assumption that the structural causal models can be represented by a</span>
<span class="sd">    :py:class:`InvertibleFunctionalCausalModel &lt;dowhy.gcm.graph.InvertibleFunctionalCausalModel&gt;` (e.g. the causal mechanisms are</span>
<span class="sd">    :py:class:`AdditiveNoiseModels &lt;dowhy.gcm.AdditiveNoiseModel&gt;` and/or :py:class:`PostNonlinearModels &lt;dowhy.gcm.PostNonlinearModel&gt;`).</span>
<span class="sd">    For this, it is checked if the residual of a causal mechanism is independent of the mechanism&#39;s input</span>
<span class="sd">    (i.e. we assume causal sufficiency here). For instance, :py:class:`PostNonlinearModels &lt;dowhy.gcm.PostNonlinearModel&gt;` represent</span>
<span class="sd">        Y = f(g(X) + N),</span>
<span class="sd">    where f is invertible (g does not need to be), X are the parents of Y and N is (assumed to be) independent noise.</span>
<span class="sd">    The latter point is important here. For given data, we can then reconstruct N and perform an independence test between X and N.</span>

<span class="sd">    Note that this method only validates the causal mechanisms and not the graph structure.</span>

<span class="sd">    For the case of post non-linear models, see the following paper for more details:</span>
<span class="sd">        Zhang, K., and A. Hyvärinen.</span>
<span class="sd">        On the Identifiability of the Post-Nonlinear Causal Model.</span>
<span class="sd">        25th Conference on Uncertainty in Artificial Intelligence (UAI 2009). AUAI Press, 2009.</span>

<span class="sd">    :param causal_model: A fitted invertible structural causal model.</span>
<span class="sd">    :param data: Observations of variables in the DAG.</span>
<span class="sd">    :param independence_test: Independence test to use for checking if residual and input are dependent.</span>
<span class="sd">    :param significance_level: Significance level for deciding whether input and residual is dependent.</span>
<span class="sd">    :param fdr_control_method: Method for false discovery rate (FDR) control. For various options, please refer to `this page &lt;https://www.statsmodels.org/dev/generated/statsmodels.stats.multitest.multipletests.html&gt;`_.</span>
<span class="sd">    :return: The outcome of the validation. The causal model can not be rejected if all causal mechanisms are consistent with</span>
<span class="sd">             the invertible model assumption.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validate_causal_graph</span><span class="p">(</span><span class="n">causal_model</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

    <span class="n">all_p_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">causal_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_root_node</span><span class="p">(</span><span class="n">causal_model</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parents_samples</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">get_ordered_predecessors</span><span class="p">(</span><span class="n">causal_model</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">)]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">causal_model</span><span class="o">.</span><span class="n">causal_mechanism</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">estimate_noise</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">parents_samples</span><span class="p">)</span>

            <span class="n">all_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">independence_test</span><span class="p">(</span><span class="n">parents_samples</span><span class="p">,</span> <span class="n">residuals</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">fdr_control_method</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_p_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">RejectionResult</span><span class="o">.</span><span class="n">NOT_REJECTED</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_p_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">significance_level</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">RejectionResult</span><span class="o">.</span><span class="n">REJECTED</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">RejectionResult</span><span class="o">.</span><span class="n">REJECTED</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">multipletests</span><span class="p">(</span><span class="n">all_p_values</span><span class="p">,</span> <span class="n">significance_level</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">fdr_control_method</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span> <span class="n">RejectionResult</span><span class="o">.</span><span class="n">NOT_REJECTED</span>
        <span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_get_non_descendants</span><span class="p">(</span><span class="n">causal_graph</span><span class="p">:</span> <span class="n">DirectedGraph</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exclude_parents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="n">nodes_to_exclude</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">causal_graph</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="n">node</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">exclude_parents</span><span class="p">:</span>
        <span class="n">nodes_to_exclude</span> <span class="o">=</span> <span class="n">nodes_to_exclude</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">causal_graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">causal_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">nodes_to_exclude</span><span class="p">))</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022, PyWhy contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
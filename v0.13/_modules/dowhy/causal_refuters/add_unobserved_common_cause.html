
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-B139P18WHM');
    </script>
    
    <title>dowhy.causal_refuters.add_unobserved_common_cause &#8212; DoWhy  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=0c6e27e1"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/dowhy/causal_refuters/add_unobserved_common_cause';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="v0.13" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-light" alt="DoWhy  documentation - Home"/>
    <img src="../../../_static/dowhy-logo-small.png" class="logo__image only-dark pst-js-only" alt="DoWhy  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../dowhy.html">
    dowhy package
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../code_repo.html">
    Release notes
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../example_notebooks/nb_index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../cite.html">
    Citing this package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../dowhy.html">
    dowhy package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../code_repo.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        v0.13
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <dd><a href="/dowhy/v0.9.1/index.html">v0.9.1</a></dd>
            <dd><a href="/dowhy/v0.9/index.html">v0.9</a></dd>
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.12/index.html">v0.12</a></dd>
            <dd><a href="/dowhy/v0.11.1/index.html">v0.11.1</a></dd>
            <dd><a href="/dowhy/v0.11/index.html">v0.11</a></dd>
            <dd><a href="/dowhy/v0.10.1/index.html">v0.10.1</a></dd>
            <dd><a href="/dowhy/v0.10/index.html">v0.10</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
        </dl>        
        <dl>
            <dt>Branches</dt>
            <dd><a href="">main</a></dd>
        </dl>        
    </div>
</div></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">dowhy.causal_refuters.add_unobserved_common_cause</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for dowhy.causal_refuters.add_unobserved_common_cause</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.auto</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">CausalEstimate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_estimators.econml</span><span class="w"> </span><span class="kn">import</span> <span class="n">Econml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_estimators.linear_regression_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegressionEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_estimators.regression_estimator</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegressionEstimator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_identifier.identified_estimand</span><span class="w"> </span><span class="kn">import</span> <span class="n">IdentifiedEstimand</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_refuter</span><span class="w"> </span><span class="kn">import</span> <span class="n">CausalRefutation</span><span class="p">,</span> <span class="n">CausalRefuter</span><span class="p">,</span> <span class="n">choose_variables</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_refuters.evalue_sensitivity_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">EValueSensitivityAnalyzer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_refuters.linear_sensitivity_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSensitivityAnalyzer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.utils.encoding</span><span class="w"> </span><span class="kn">import</span> <span class="n">Encoders</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="n">DEFAULT_CONVERGENCE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">DEFAULT_C_STAR_MAX</span> <span class="o">=</span> <span class="mi">1000</span>


<div class="viewcode-block" id="AddUnobservedCommonCause">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AddUnobservedCommonCause</span><span class="p">(</span><span class="n">CausalRefuter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an unobserved confounder for refutation.</span>

<span class="sd">    AddUnobservedCommonCause class supports three methods:</span>
<span class="sd">        1) Simulation of an unobserved confounder</span>
<span class="sd">        2) Linear partial R2 : Sensitivity Analysis for linear models.</span>
<span class="sd">        3) Non-Parametric partial R2 based : Sensitivity Analyis for non-parametric models.</span>

<span class="sd">    Supports additional parameters that can be specified in the refute_estimate() method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the parameters required for the refuter.</span>

<span class="sd">        For direct_simulation, if effect_strength_on_treatment or effect_strength_on_outcome is not</span>
<span class="sd">        given, it is calculated automatically as a range between the</span>
<span class="sd">        minimum and maximum effect strength of observed confounders on treatment</span>
<span class="sd">        and outcome respectively.</span>

<span class="sd">        :param simulation_method: The method to use for simulating effect of unobserved confounder. Possible values are [&quot;direct-simulation&quot;, &quot;linear-partial-R2&quot;, &quot;non-parametric-partial-R2&quot;, &quot;e-value&quot;].</span>
<span class="sd">        :param confounders_effect_on_treatment: str : The type of effect on the treatment due to the unobserved confounder. Possible values are [&#39;binary_flip&#39;, &#39;linear&#39;]</span>
<span class="sd">        :param confounders_effect_on_outcome: str : The type of effect on the outcome due to the unobserved confounder. Possible values are [&#39;binary_flip&#39;, &#39;linear&#39;]</span>
<span class="sd">        :param effect_strength_on_treatment: float, numpy.ndarray: [Used when simulation_method=&quot;direct-simulation&quot;] Strength of the confounder&#39;s effect on treatment. When confounders_effect_on_treatment is linear,  it is the regression coefficient. When the confounders_effect_on_treatment is binary flip, it is the probability with which effect of unobserved confounder can invert the value of the treatment.</span>
<span class="sd">        :param effect_strength_on_outcome: float, numpy.ndarray: Strength of the confounder&#39;s effect on outcome. Its interpretation depends on confounders_effect_on_outcome and the simulation_method. When simulation_method is direct-simulation, for a linear effect it behaves like the regression coefficient and for a binary flip, it is the probability with which it can invert the value of the outcome.</span>
<span class="sd">        :param partial_r2_confounder_treatment: float, numpy.ndarray: [Used when simulation_method is linear-partial-R2 or non-parametric-partial-R2] Partial R2 of the unobserved confounder wrt the treatment conditioned on the observed confounders. Only in the case of general non-parametric-partial-R2, it is the fraction of variance in the reisz representer that is explained by the unobserved confounder; specifically  (1-r), where r is the ratio of variance of reisz representer, alpha^2, based on observed confounders and that based on all confounders.</span>
<span class="sd">        :param partial_r2_confounder_outcome: float, numpy.ndarray: [Used when simulation_method is linear-partial-R2 or non-parametric-partial-R2] Partial R2 of the unobserved confounder wrt the outcome conditioned on the treatment and observed confounders.</span>
<span class="sd">        :param frac_strength_treatment: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on treatment. Defaults to 1.</span>
<span class="sd">        :param frac_strength_outcome: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on outcome. Defaults to 1.</span>
<span class="sd">        :param plotmethod: string: Type of plot to be shown. If None, no plot is generated. This parameter is used only only when more than one treatment confounder effect values or outcome confounder effect values are provided. Default is &quot;colormesh&quot;. Supported values are &quot;contour&quot;, &quot;colormesh&quot; when more than one value is provided for both confounder effect value parameters; &quot;line&quot; when provided for only one of them.</span>
<span class="sd">        :param percent_change_estimate: It is the percentage of reduction of treatment estimate that could alter the results (default = 1).</span>
<span class="sd">                                        if percent_change_estimate = 1, the robustness value describes the strength of association of confounders with treatment and outcome in order to reduce the estimate by 100% i.e bring it down to 0. (relevant only for Linear Sensitivity Analysis, ignore for rest)</span>
<span class="sd">        :param confounder_increases_estimate: True implies that confounder increases the absolute value of estimate and vice versa. (Default = False). (relevant only for Linear Sensitivity Analysis, ignore for rest)</span>
<span class="sd">        :param benchmark_common_causes: names of variables for bounding strength of confounders. (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">        :param significance_level: confidence interval for statistical inference(default = 0.05). (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">        :param null_hypothesis_effect: assumed effect under the null hypothesis. (relevant only for linear-partial-R2, ignore for rest)</span>
<span class="sd">        :param plot_estimate: Generate contour plot for estimate while performing sensitivity analysis. (default = True).</span>
<span class="sd">                              (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">        :param num_splits: number of splits for cross validation. (default = 5). (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        :param shuffle_data : shuffle data or not before splitting into folds (default = False). (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        :param shuffle_random_seed: seed for randomly shuffling data. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        :param alpha_s_estimator_param_list: list of dictionaries with parameters for finding alpha_s. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        :param g_s_estimator_list: list of estimator objects for finding g_s. These objects should have fit() and predict() functions implemented. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        :param g_s_estimator_param_list: list of dictionaries with parameters for tuning respective estimators in &quot;g_s_estimator_list&quot;. The order of the dictionaries in the list should be consistent with the estimator objects order in &quot;g_s_estimator_list&quot;. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;simulation_method&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;simulation_method&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;direct-simulation&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effect_on_t</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;confounders_effect_on_treatment&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;confounders_effect_on_treatment&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;binary_flip&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effect_on_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;confounders_effect_on_outcome&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;confounders_effect_on_outcome&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;linear&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;direct-simulation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_t</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;effect_strength_on_treatment&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;effect_strength_on_treatment&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;effect_strength_on_outcome&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;effect_strength_on_outcome&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear-partial-R2&quot;</span><span class="p">,</span> <span class="s2">&quot;non-parametric-partial-R2&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_t</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;partial_r2_confounder_treatment&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;partial_r2_confounder_treatment&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_y</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;partial_r2_confounder_outcome&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;partial_r2_confounder_outcome&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;e-value&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;simulation method is not supported. Try direct-simulation, linear-partial-R2, non-parametric-partial-R2, or e-value&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_treatment</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;effect_fraction_on_treatment&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;effect_fraction_on_treatment&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_outcome</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;effect_fraction_on_outcome&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;effect_fraction_on_outcome&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;plotmethod&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;plotmethod&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;colormesh&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percent_change_estimate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;percent_change_estimate&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;percent_change_estimate&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">significance_level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;significance_level&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;significance_level&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.05</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confounder_increases_estimate</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;confounder_increases_estimate&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;confounder_increases_estimate&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_common_causes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;benchmark_common_causes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;benchmark_common_causes&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">null_hypothesis_effect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;null_hypothesis_effect&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;null_hypothesis_effect&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_estimate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;plot_estimate&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;plot_estimate&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_splits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;num_splits&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;num_splits&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shuffle_data&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;shuffle_data&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_random_seed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;shuffle_random_seed&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;shuffle_random_seed&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_s_estimator_param_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;alpha_s_estimator_param_list&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;alpha_s_estimator_param_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_s_estimator_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;alpha_s_estimator_list&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;alpha_s_estimator_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_s_estimator_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;g_s_estimator_list&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;g_s_estimator_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_s_estimator_param_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;g_s_estimator_param_list&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;g_s_estimator_param_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_reisz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;plugin_reisz&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;plugin_reisz&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="AddUnobservedCommonCause.refute_estimate">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause.refute_estimate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">refute_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;linear-partial-R2&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sensitivity_linear_partial_r2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">percent_change_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_common_causes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">significance_level</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">null_hypothesis_effect</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_estimate</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;non-parametric-partial-R2&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sensitivity_non_parametric_partial_r2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kappa_t</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kappa_y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_common_causes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alpha_s_estimator_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alpha_s_estimator_param_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g_s_estimator_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g_s_estimator_param_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plugin_reisz</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;e-value&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sensitivity_e_value</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_estimate</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_method</span> <span class="o">==</span> <span class="s2">&quot;direct-simulation&quot;</span><span class="p">:</span>
            <span class="n">refute</span> <span class="o">=</span> <span class="n">sensitivity_simulation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kappa_t</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kappa_y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">effect_on_t</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">effect_on_y</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotmethod</span><span class="p">,</span>
                <span class="n">show_progress_bar</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">refute</span><span class="o">.</span><span class="n">add_refuter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">refute</span></div>


<div class="viewcode-block" id="AddUnobservedCommonCause.include_simulated_confounder">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.AddUnobservedCommonCause.include_simulated_confounder">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">include_simulated_confounder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">convergence_threshold</span><span class="o">=</span><span class="n">DEFAULT_CONVERGENCE_THRESHOLD</span><span class="p">,</span> <span class="n">c_star_max</span><span class="o">=</span><span class="n">DEFAULT_C_STAR_MAX</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">include_simulated_confounder</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_t</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kappa_y</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_variables_of_interest</span><span class="p">,</span>
            <span class="n">convergence_threshold</span><span class="p">,</span>
            <span class="n">c_star_max</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="preprocess_observed_common_causes">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.preprocess_observed_common_causes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_observed_common_causes</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
    <span class="n">no_common_causes_error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocesses adjustment variables (observed common causes) and returns the pre-processed matrix.</span>

<span class="sd">    At least one covariate (common cause) variable is required. Raises an exception if none present.</span>

<span class="sd">    Preprocessing has two steps:</span>
<span class="sd">    1. Categorical encoding.</span>
<span class="sd">    2. Standardization.</span>

<span class="sd">    :param data: All data, some of which needs preprocessing.</span>
<span class="sd">    :param target_estimand: Estimand for desired effect including definition of backdoor variables.</span>
<span class="sd">    :param no_common_causes_error_message: Message to be displayed with ValueError if no backdoor variable present.</span>
<span class="sd">    :return: DataFrame containing pre-processed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. Categorical encoding of relevant variables</span>
    <span class="n">observed_common_causes_names</span> <span class="o">=</span> <span class="n">target_estimand</span><span class="o">.</span><span class="n">get_adjustment_set</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observed_common_causes_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># The encoded data is only used to calculate a parameter, so the encoder can be discarded.</span>
        <span class="n">observed_common_causes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">observed_common_causes_names</span><span class="p">]</span>
        <span class="n">encoders</span> <span class="o">=</span> <span class="n">Encoders</span><span class="p">()</span>
        <span class="n">observed_common_causes</span> <span class="o">=</span> <span class="n">encoders</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">,</span> <span class="s2">&quot;observed_common_causes&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">no_common_causes_error_message</span><span class="p">)</span>

    <span class="c1"># 2. Standardizing the data</span>
    <span class="n">observed_common_causes</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">observed_common_causes</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_infer_default_kappa_t</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">effect_on_t</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frac_strength_treatment</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">len_kappa_t</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Infer default effect strength of simulated confounder on treatment.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span>
    <span class="n">no_common_causes_error_message</span> <span class="o">=</span> <span class="s2">&quot;There needs to be at least one common cause to automatically compute the default value of kappa_t. Provide a value for kappa_t&quot;</span>
    <span class="n">observed_common_causes</span> <span class="o">=</span> <span class="n">preprocess_observed_common_causes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_estimand</span><span class="p">,</span> <span class="n">no_common_causes_error_message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">effect_on_t</span> <span class="o">==</span> <span class="s2">&quot;binary_flip&quot;</span><span class="p">:</span>
        <span class="c1"># Fit a model containing all confounders and compare predictions</span>
        <span class="c1"># using all features compared to all features except a given</span>
        <span class="c1"># confounder.</span>
        <span class="n">tmodel</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">tpred</span> <span class="o">=</span> <span class="n">tmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">flips</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">oldval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tcap</span> <span class="o">=</span> <span class="n">tmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldval</span>
            <span class="n">flips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tcap</span> <span class="o">-</span> <span class="n">tpred</span><span class="p">))</span> <span class="o">/</span> <span class="n">tpred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flips</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">flips</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">effect_on_t</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="c1"># Estimating the regression coefficient from standardized features to t</span>
        <span class="n">corrcoef_var_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">std_dev_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">corrcoef_var_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">std_dev_t</span>
        <span class="n">min_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">corrcoef_var_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">std_dev_t</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">effect_on_t</span> <span class="o">+</span> <span class="s2">&quot;&#39; method not supported for confounders&#39; effect on treatment&quot;</span><span class="p">)</span>

    <span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span> <span class="o">=</span> <span class="n">_compute_min_max_coeff</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">,</span> <span class="n">frac_strength_treatment</span><span class="p">)</span>
    <span class="c1"># By default, return a plot with 10 points</span>
    <span class="c1"># consider 10 values of the effect of the unobserved confounder</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_coeff</span> <span class="o">-</span> <span class="n">min_coeff</span><span class="p">)</span> <span class="o">/</span> <span class="n">len_kappa_t</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;(Min, Max) kappa_t for observed common causes, (</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">max_coeff</span><span class="p">,</span> <span class="n">min_coeff</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">max_coeff</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_compute_min_max_coeff</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">effect_strength_fraction</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="n">max_coeff</span> <span class="o">=</span> <span class="n">effect_strength_fraction</span> <span class="o">*</span> <span class="n">max_coeff</span>
    <span class="n">min_coeff</span> <span class="o">=</span> <span class="n">effect_strength_fraction</span> <span class="o">*</span> <span class="n">min_coeff</span>
    <span class="k">return</span> <span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_infer_default_kappa_y</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">effect_on_y</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frac_strength_outcome</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">len_kappa_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Infer default effect strength of simulated confounder on treatment.&quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">]</span>
    <span class="n">no_common_causes_error_message</span> <span class="o">=</span> <span class="s2">&quot;There needs to be at least one common cause to automatically compute the default value of kappa_y. Provide a value for kappa_y&quot;</span>
    <span class="n">observed_common_causes</span> <span class="o">=</span> <span class="n">preprocess_observed_common_causes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_estimand</span><span class="p">,</span> <span class="n">no_common_causes_error_message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">effect_on_y</span> <span class="o">==</span> <span class="s2">&quot;binary_flip&quot;</span><span class="p">:</span>
        <span class="c1"># Fit a model containing all confounders and compare predictions</span>
        <span class="c1"># using all features compared to all features except a given</span>
        <span class="c1"># confounder.</span>
        <span class="n">ymodel</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ypred</span> <span class="o">=</span> <span class="n">ymodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">flips</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">oldval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ycap</span> <span class="o">=</span> <span class="n">ymodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">observed_common_causes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldval</span>
            <span class="n">flips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ycap</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span> <span class="o">/</span> <span class="n">ypred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flips</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">flips</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">effect_on_y</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">corrcoef_var_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">observed_common_causes</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">std_dev_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">corrcoef_var_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">std_dev_y</span>
        <span class="n">min_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">corrcoef_var_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">std_dev_y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">effect_on_y</span> <span class="o">+</span> <span class="s2">&quot;&#39; method not supported for confounders&#39; effect on outcome&quot;</span><span class="p">)</span>
    <span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span> <span class="o">=</span> <span class="n">_compute_min_max_coeff</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">,</span> <span class="n">frac_strength_outcome</span><span class="p">)</span>
    <span class="c1"># By default, return a plot with 10 points</span>
    <span class="c1"># consider 10 values of the effect of the unobserved confounder</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_coeff</span> <span class="o">-</span> <span class="n">min_coeff</span><span class="p">)</span> <span class="o">/</span> <span class="n">len_kappa_y</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;(Min, Max) kappa_y for observed common causes, (</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">max_coeff</span><span class="p">,</span> <span class="n">min_coeff</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">max_coeff</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_coeff</span><span class="p">,</span> <span class="n">max_coeff</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_include_confounders_effect</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">new_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">effect_on_t</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">kappa_t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">effect_on_y</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">kappa_y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function deals with the change in the value of the data due to the effect of the unobserved confounder.</span>
<span class="sd">    In the case of a binary flip, we flip only if the random number is greater than the threshold set.</span>
<span class="sd">    In the case of a linear effect, we use the variable as the linear regression constant.</span>

<span class="sd">    :param new_data: pandas.DataFrame: The data to be changed due to the effects of the unobserved confounder.</span>
<span class="sd">    :param kappa_t: numpy.float64: The value of the threshold for binary_flip or the value of the regression coefficient for linear effect.</span>
<span class="sd">    :param kappa_y: numpy.float64: The value of the threshold for binary_flip or the value of the regression coefficient for linear effect.</span>

<span class="sd">    :return: pandas.DataFrame: The DataFrame that includes the effects of the unobserved confounder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_rows</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">stdnorm</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="n">w_random</span> <span class="o">=</span> <span class="n">stdnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">effect_on_t</span> <span class="o">==</span> <span class="s2">&quot;binary_flip&quot;</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa_t</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">kappa_t</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa_t</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">stdnorm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">rel_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">kappa_t</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_interval</span> <span class="o">&lt;=</span> <span class="n">w_random</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">-</span> <span class="n">new_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_interval</span> <span class="o">&lt;=</span> <span class="n">w_random</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">treatment_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tname</span><span class="p">]):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">tname</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">effect_on_t</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">confounder_t_effect</span> <span class="o">=</span> <span class="n">kappa_t</span> <span class="o">*</span> <span class="n">w_random</span>
        <span class="c1"># By default, we add the effect of simulated confounder for treatment.</span>
        <span class="c1"># But subtract it from outcome to create a negative correlation</span>
        <span class="c1"># assuming that the original confounder&#39;s effect was positive on both.</span>
        <span class="c1"># This is to remove the effect of the original confounder.</span>
        <span class="n">new_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">buffer</span><span class="o">=</span><span class="n">confounder_t_effect</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">effect_on_t</span> <span class="o">+</span> <span class="s2">&quot;&#39; method not supported for confounders&#39; effect on treatment&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">effect_on_y</span> <span class="o">==</span> <span class="s2">&quot;binary_flip&quot;</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa_y</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">kappa_y</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa_y</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">stdnorm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">rel_interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">kappa_y</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_interval</span> <span class="o">&lt;=</span> <span class="n">w_random</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">new_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rel_interval</span> <span class="o">&lt;=</span> <span class="n">w_random</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">yname</span> <span class="ow">in</span> <span class="n">outcome_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_bool_dtype</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">yname</span><span class="p">]):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">yname</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">effect_on_y</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">confounder_y_effect</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">kappa_y</span> <span class="o">*</span> <span class="n">w_random</span>
        <span class="c1"># By default, we add the effect of simulated confounder for treatment.</span>
        <span class="c1"># But subtract it from outcome to create a negative correlation</span>
        <span class="c1"># assuming that the original confounder&#39;s effect was positive on both.</span>
        <span class="c1"># This is to remove the effect of the original confounder.</span>
        <span class="n">new_data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span>
            <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">buffer</span><span class="o">=</span><span class="n">confounder_y_effect</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">effect_on_y</span> <span class="o">+</span> <span class="s2">&quot;&#39; method not supported for confounders&#39; effect on outcome&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_data</span>


<div class="viewcode-block" id="include_simulated_confounder">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.include_simulated_confounder">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">include_simulated_confounder</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">kappa_t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">kappa_y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">variables_of_interest</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
    <span class="n">convergence_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_CONVERGENCE_THRESHOLD</span><span class="p">,</span>
    <span class="n">c_star_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_C_STAR_MAX</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function simulates an unobserved confounder based on the data using the following steps:</span>
<span class="sd">    1. It calculates the &quot;residuals&quot;  from the treatment and outcome model</span>
<span class="sd">    i.) The outcome model has outcome as the dependent variable and all the observed variables including treatment as independent variables</span>
<span class="sd">    ii.) The treatment model has treatment as the dependent variable and all the observed variables as independent variables.</span>

<span class="sd">    2. U is an intermediate random variable drawn from the normal distribution with the weighted average of residuals as mean and a unit variance</span>
<span class="sd">    U ~ N(c1*d_y + c2*d_t, 1)</span>
<span class="sd">    where</span>
<span class="sd">    *d_y and d_t are residuals from the treatment and outcome model</span>
<span class="sd">    *c1 and c2 are coefficients to the residuals</span>

<span class="sd">    3. The final U, which is the simulated unobserved confounder is obtained by debiasing the intermediate variable U by residualising it with X</span>


<span class="sd">    Choosing the coefficients c1 and c2:</span>
<span class="sd">    The coefficients are chosen based on these basic assumptions:</span>
<span class="sd">    1. There is a hyperbolic relationship satisfying c1*c2 = c_star</span>
<span class="sd">    2. c_star is chosen from a range of possible values based on the correlation of the obtained simulated variable with outcome and treatment.</span>
<span class="sd">    3. The product of correlations with treatment and outcome should be at a minimum distance to the maximum correlations with treatment and outcome in any of the observed confounders</span>
<span class="sd">    4. The ratio of the weights should be such that they maintain the ratio of the maximum possible observed coefficients within some confidence interval</span>

<span class="sd">    :param c_star_max: The maximum possible value for the hyperbolic curve on which the coefficients to the residuals lie. It defaults to 1000 in the code if not specified by the user.</span>
<span class="sd">        :type int</span>
<span class="sd">    :param convergence_threshold: The threshold to check the plateauing of the correlation while selecting a c_star. It defaults to 0.1 in the code if not specified by the user</span>
<span class="sd">        :type float</span>

<span class="sd">    :returns: The simulated values of the unobserved confounder based on the data</span>
<span class="sd">        :type pandas.core.series.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Obtaining the list of observed variables</span>
    <span class="n">required_variables</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">observed_variables</span> <span class="o">=</span> <span class="n">choose_variables</span><span class="p">(</span><span class="n">required_variables</span><span class="p">,</span> <span class="n">variables_of_interest</span><span class="p">)</span>

    <span class="n">observed_variables_with_treatment_and_outcome</span> <span class="o">=</span> <span class="n">observed_variables</span> <span class="o">+</span> <span class="n">treatment_name</span> <span class="o">+</span> <span class="n">outcome_name</span>

    <span class="c1"># Taking a subset of the dataframe that has only observed variables</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">observed_variables_with_treatment_and_outcome</span><span class="p">]</span>

    <span class="c1"># Residuals from the outcome model obtained by fitting a linear model</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">observed_variables_with_treatment</span> <span class="o">=</span> <span class="n">observed_variables</span> <span class="o">+</span> <span class="n">treatment_name</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">observed_variables_with_treatment</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">residuals_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="n">d_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals_y</span><span class="p">))</span>

    <span class="c1"># Residuals from the treatment model obtained by fitting a linear model</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">observed_variables</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">residuals_t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="n">d_t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">residuals_t</span><span class="p">))</span>

    <span class="c1"># Initialising product_cor_metric_observed with a really low value as finding maximum</span>
    <span class="n">product_cor_metric_observed</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000000000</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">observed_variables</span><span class="p">:</span>
        <span class="n">current_obs_confounder</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">outcome_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">correlation_y</span> <span class="o">=</span> <span class="n">current_obs_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">outcome_values</span><span class="p">)</span>
        <span class="n">treatment_values</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">correlation_t</span> <span class="o">=</span> <span class="n">current_obs_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">treatment_values</span><span class="p">)</span>
        <span class="n">product_cor_metric_current</span> <span class="o">=</span> <span class="n">correlation_y</span> <span class="o">*</span> <span class="n">correlation_t</span>
        <span class="k">if</span> <span class="n">product_cor_metric_current</span> <span class="o">&gt;=</span> <span class="n">product_cor_metric_observed</span><span class="p">:</span>
            <span class="n">product_cor_metric_observed</span> <span class="o">=</span> <span class="n">product_cor_metric_current</span>
            <span class="n">correlation_t_observed</span> <span class="o">=</span> <span class="n">correlation_t</span>
            <span class="n">correlation_y_observed</span> <span class="o">=</span> <span class="n">correlation_y</span>

    <span class="c1"># The user has an option to give the the effect_strength_on_y and effect_strength_on_t which can be then used instead of maximum correlation with treatment and outcome in the observed variables as it specifies the desired effect.</span>
    <span class="k">if</span> <span class="n">kappa_t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">correlation_t_observed</span> <span class="o">=</span> <span class="n">kappa_t</span>
    <span class="k">if</span> <span class="n">kappa_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">correlation_y_observed</span> <span class="o">=</span> <span class="n">kappa_y</span>

    <span class="c1"># Choosing a c_star based on the data.</span>
    <span class="c1"># The correlations stop increasing upon increasing c_star after a certain value, that is it plateaus and we choose the value of c_star to be the value it plateaus.</span>

    <span class="n">correlation_y_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">correlation_t_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">product_cor_metric_simulated_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c_star_max</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">c_star_max</span><span class="p">),</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="n">final_U</span> <span class="o">=</span> <span class="n">_generate_confounder_from_residuals</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_t</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
        <span class="n">current_simulated_confounder</span> <span class="o">=</span> <span class="n">final_U</span>
        <span class="n">outcome_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">correlation_y</span> <span class="o">=</span> <span class="n">current_simulated_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">outcome_values</span><span class="p">)</span>
        <span class="n">correlation_y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">correlation_y</span><span class="p">)</span>

        <span class="n">treatment_values</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">correlation_t</span> <span class="o">=</span> <span class="n">current_simulated_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">treatment_values</span><span class="p">)</span>
        <span class="n">correlation_t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">correlation_t</span><span class="p">)</span>

        <span class="n">product_cor_metric_simulated</span> <span class="o">=</span> <span class="n">correlation_y</span> <span class="o">*</span> <span class="n">correlation_t</span>
        <span class="n">product_cor_metric_simulated_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product_cor_metric_simulated</span><span class="p">)</span>

        <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">correlation_y_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">correlation_y_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">correlation_y_list</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">convergence_threshold</span><span class="p">:</span>
            <span class="n">c_star</span> <span class="o">=</span> <span class="n">x_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Choosing c1 and c2 based on the hyperbolic relationship once c_star is chosen by going over various combinations of c1 and c2 values and choosing the combination which</span>
    <span class="c1"># which maintains the minimum distance between the product of correlations of the simulated variable and the product of maximum correlations of one of the observed variables</span>
    <span class="c1"># and additionally checks if the ratio of the weights are such that they maintain the ratio of the maximum possible observed coefficients within some confidence interval</span>

    <span class="c1"># c1_final and c2_final are initialised to the values on the hyperbolic curve such that c1_final = c2_final  and c1_final*c2_final = c_star</span>
    <span class="n">c1_final</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_star</span><span class="p">)</span>
    <span class="n">c2_final</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c_star</span><span class="p">)</span>

    <span class="c1"># initialising min_distance_between_product_cor_metrics to be a value greater than 1</span>
    <span class="n">min_distance_between_product_cor_metrics</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mf">0.05</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="n">c_star</span> <span class="o">/</span> <span class="mf">0.05</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">c_star</span> <span class="o">/</span> <span class="n">c2</span>
        <span class="n">final_U</span> <span class="o">=</span> <span class="n">_generate_confounder_from_residuals</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_t</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

        <span class="n">current_simulated_confounder</span> <span class="o">=</span> <span class="n">final_U</span>
        <span class="n">outcome_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">correlation_y</span> <span class="o">=</span> <span class="n">current_simulated_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">outcome_values</span><span class="p">)</span>

        <span class="n">treatment_values</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">correlation_t</span> <span class="o">=</span> <span class="n">current_simulated_confounder</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">treatment_values</span><span class="p">)</span>

        <span class="n">product_cor_metric_simulated</span> <span class="o">=</span> <span class="n">correlation_y</span> <span class="o">*</span> <span class="n">correlation_t</span>

        <span class="k">if</span> <span class="n">min_distance_between_product_cor_metrics</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">product_cor_metric_simulated</span> <span class="o">-</span> <span class="n">product_cor_metric_observed</span><span class="p">):</span>
            <span class="n">min_distance_between_product_cor_metrics</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">product_cor_metric_simulated</span> <span class="o">-</span> <span class="n">product_cor_metric_observed</span><span class="p">)</span>
            <span class="n">additional_condition</span> <span class="o">=</span> <span class="n">correlation_y_observed</span> <span class="o">/</span> <span class="n">correlation_t_observed</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">c1</span> <span class="o">/</span> <span class="n">c2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">additional_condition</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">additional_condition</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">c1</span> <span class="o">/</span> <span class="n">c2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">additional_condition</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">additional_condition</span><span class="p">)</span>
            <span class="p">):</span>  <span class="c1"># choose minimum positive value</span>
                <span class="n">c1_final</span> <span class="o">=</span> <span class="n">c1</span>
                <span class="n">c2_final</span> <span class="o">=</span> <span class="n">c2</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">1.5</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;#closed form solution</span>

<span class="sd">    print(&quot;c_star_max before closed form&quot;, c_star_max)</span>

<span class="sd">    if max_correlation_with_t == -1000:</span>
<span class="sd">        c2 = 0</span>
<span class="sd">        c1 = c_star_max</span>
<span class="sd">    else:</span>
<span class="sd">        additional_condition = abs(max_correlation_with_y/max_correlation_with_t)</span>
<span class="sd">        print(&quot;additional_condition&quot;, additional_condition)</span>
<span class="sd">        c2 = math.sqrt(c_star_max/additional_condition)</span>
<span class="sd">        c1 = c_star_max/c2&quot;&quot;&quot;</span>

    <span class="n">final_U</span> <span class="o">=</span> <span class="n">_generate_confounder_from_residuals</span><span class="p">(</span><span class="n">c1_final</span><span class="p">,</span> <span class="n">c2_final</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_t</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_U</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_generate_confounder_from_residuals</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">d_y</span><span class="p">,</span> <span class="n">d_t</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes the residuals from the treatment and outcome model and their coefficients and simulates the intermediate random variable U by taking</span>
<span class="sd">    the row wise normal distribution corresponding to each residual value and then debiasing the intermediate variable to get the final variable.</span>

<span class="sd">    :param c1: coefficient to the residual from the outcome model</span>
<span class="sd">    :type float</span>
<span class="sd">    :param c2: coefficient to the residual from the treatment model</span>
<span class="sd">    :type float</span>
<span class="sd">    :param d_y: residuals from the outcome model</span>
<span class="sd">    :type list</span>
<span class="sd">    :param d_t: residuals from the treatment model</span>
<span class="sd">    :type list</span>

<span class="sd">    :returns: The simulated values of the unobserved confounder based on the data</span>
<span class="sd">    :type pandas.core.series.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_t</span><span class="p">)):</span>
        <span class="n">simulated_variable_mean</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">d_y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">d_t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">simulated_variable_stddev</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">simulated_variable_mean</span><span class="p">,</span> <span class="n">simulated_variable_stddev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">final_U</span> <span class="o">=</span> <span class="n">U</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">.</span><span class="n">values</span>
    <span class="n">final_U</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_U</span>


<div class="viewcode-block" id="sensitivity_linear_partial_r2">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.sensitivity_linear_partial_r2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_linear_partial_r2</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">estimate</span><span class="p">:</span> <span class="n">CausalEstimate</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frac_strength_treatment</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">frac_strength_outcome</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">percent_change_estimate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">benchmark_common_causes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">significance_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">null_hypothesis_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_estimate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearSensitivityAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an unobserved confounder for refutation using Linear partial R2 methond (Sensitivity Analysis for linear models).</span>

<span class="sd">    :param data: pd.DataFrame: Data to run the refutation</span>
<span class="sd">    :param estimate: CausalEstimate: Estimate to run the refutation</span>
<span class="sd">    :param treatment_name: str: Name of the treatment</span>
<span class="sd">    :param frac_strength_treatment: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on treatment. Defaults to 1.</span>
<span class="sd">    :param frac_strength_outcome: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on outcome. Defaults to 1.</span>
<span class="sd">    :param percent_change_estimate: It is the percentage of reduction of treatment estimate that could alter the results (default = 1).</span>
<span class="sd">                                    if percent_change_estimate = 1, the robustness value describes the strength of association of confounders with treatment and outcome in order to reduce the estimate by 100% i.e bring it down to 0. (relevant only for Linear Sensitivity Analysis, ignore for rest)</span>
<span class="sd">    :param benchmark_common_causes: names of variables for bounding strength of confounders. (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">    :param significance_level: confidence interval for statistical inference(default = 0.05). (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">    :param null_hypothesis_effect: assumed effect under the null hypothesis. (relevant only for linear-partial-R2, ignore for rest)</span>
<span class="sd">    :param plot_estimate: Generate contour plot for estimate while performing sensitivity analysis. (default = True).</span>
<span class="sd">                            (relevant only for partial-r2 based simulation methods)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">LinearRegressionEstimator</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Currently only LinearRegressionEstimator is supported for Sensitivity Analysis&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The current implementation does not support effect modifiers&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">frac_strength_outcome</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">frac_strength_outcome</span> <span class="o">=</span> <span class="n">frac_strength_treatment</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">LinearSensitivityAnalyzer</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">treatment_name</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">,</span>
        <span class="n">percent_change_estimate</span><span class="o">=</span><span class="n">percent_change_estimate</span><span class="p">,</span>
        <span class="n">significance_level</span><span class="o">=</span><span class="n">significance_level</span><span class="p">,</span>
        <span class="n">benchmark_common_causes</span><span class="o">=</span><span class="n">benchmark_common_causes</span><span class="p">,</span>
        <span class="n">null_hypothesis_effect</span><span class="o">=</span><span class="n">null_hypothesis_effect</span><span class="p">,</span>
        <span class="n">frac_strength_treatment</span><span class="o">=</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
        <span class="n">frac_strength_outcome</span><span class="o">=</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
        <span class="n">common_causes_order</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_observed_common_causes</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">analyzer</span><span class="o">.</span><span class="n">check_sensitivity</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot_estimate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analyzer</span></div>



<span class="c1"># TODO (petergtz): This should introduce a Protocol defining the interface this returns instead of the concrete types</span>
<div class="viewcode-block" id="sensitivity_non_parametric_partial_r2">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.sensitivity_non_parametric_partial_r2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_non_parametric_partial_r2</span><span class="p">(</span>
    <span class="n">estimate</span><span class="p">:</span> <span class="n">CausalEstimate</span><span class="p">,</span>
    <span class="n">kappa_t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kappa_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">frac_strength_treatment</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">frac_strength_outcome</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">benchmark_common_causes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_estimate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">alpha_s_estimator_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha_s_estimator_param_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">g_s_estimator_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">g_s_estimator_param_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plugin_reisz</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># -&gt; Union[PartialLinearSensitivityAnalyzer, NonParametricSensitivityAnalyzer]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an unobserved confounder for refutation using Non-parametric partial R2 methond (Sensitivity Analysis for non-parametric models).</span>

<span class="sd">    :param estimate: CausalEstimate: Estimate to run the refutation</span>
<span class="sd">    :param kappa_t: float, numpy.ndarray: Partial R2 of the unobserved confounder wrt the treatment conditioned on the observed confounders. Only in the case of general non-parametric-partial-R2, it is the fraction of variance in the reisz representer that is explained by the unobserved confounder; specifically  (1-r), where r is the ratio of variance of reisz representer, alpha^2, based on observed confounders and that based on all confounders.</span>
<span class="sd">    :param kappa_y: float, numpy.ndarray: Partial R2 of the unobserved confounder wrt the outcome conditioned on the treatment and observed confounders.</span>
<span class="sd">    :param frac_strength_treatment: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on treatment. Defaults to 1.</span>
<span class="sd">    :param frac_strength_outcome: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on outcome. Defaults to 1.</span>
<span class="sd">    :param benchmark_common_causes: names of variables for bounding strength of confounders. (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">    :param plot_estimate: Generate contour plot for estimate while performing sensitivity analysis. (default = True).</span>
<span class="sd">                            (relevant only for partial-r2 based simulation methods)</span>
<span class="sd">    :param alpha_s_estimator_list: list of estimator objects for estimating alpha_s. These objects should have fit() and predict() methods (relevant only for non-parametric-partial-R2 method)</span>
<span class="sd">    :param alpha_s_estimator_param_list: list of dictionaries with parameters for finding alpha_s. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">    :param g_s_estimator_list: list of estimator objects for finding g_s. These objects should have fit() and predict() functions implemented. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">    :param g_s_estimator_param_list: list of dictionaries with parameters for tuning respective estimators in &quot;g_s_estimator_list&quot;. The order of the dictionaries in the list should be consistent with the estimator objects order in &quot;g_s_estimator_list&quot;. (relevant only for non-parametric-partial-R2 simulation method)</span>
<span class="sd">    :plugin_reisz: bool: Flag on whether to use the plugin estimator or the nonparametric estimator for reisz representer function (alpha_s).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">dowhy.causal_estimators.econml</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_refuters.non_parametric_sensitivity_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">NonParametricSensitivityAnalyzer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dowhy.causal_refuters.partial_linear_sensitivity_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">PartialLinearSensitivityAnalyzer</span>

    <span class="c1"># If the estimator used is LinearDML, partially linear sensitivity analysis will be automatically chosen</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">dowhy</span><span class="o">.</span><span class="n">causal_estimators</span><span class="o">.</span><span class="n">econml</span><span class="o">.</span><span class="n">Econml</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;LinearDML&quot;</span>
    <span class="p">):</span>

        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">PartialLinearSensitivityAnalyzer</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">_estimator_object</span><span class="p">,</span>
            <span class="n">observed_common_causes</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_observed_common_causes</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">estimate</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">],</span>
            <span class="n">outcome</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">estimate</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">alpha_s_estimator_param_list</span><span class="o">=</span><span class="n">alpha_s_estimator_param_list</span><span class="p">,</span>
            <span class="n">g_s_estimator_list</span><span class="o">=</span><span class="n">g_s_estimator_list</span><span class="p">,</span>
            <span class="n">g_s_estimator_param_list</span><span class="o">=</span><span class="n">g_s_estimator_param_list</span><span class="p">,</span>
            <span class="n">effect_strength_treatment</span><span class="o">=</span><span class="n">kappa_t</span><span class="p">,</span>
            <span class="n">effect_strength_outcome</span><span class="o">=</span><span class="n">kappa_y</span><span class="p">,</span>
            <span class="n">benchmark_common_causes</span><span class="o">=</span><span class="n">benchmark_common_causes</span><span class="p">,</span>
            <span class="n">frac_strength_treatment</span><span class="o">=</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
            <span class="n">frac_strength_outcome</span><span class="o">=</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">analyzer</span><span class="o">.</span><span class="n">check_sensitivity</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot_estimate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">analyzer</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">NonParametricSensitivityAnalyzer</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span>
        <span class="n">observed_common_causes</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_observed_common_causes</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">estimate</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">],</span>
        <span class="n">outcome</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">estimate</span><span class="o">.</span><span class="n">_outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">alpha_s_estimator_list</span><span class="o">=</span><span class="n">alpha_s_estimator_list</span><span class="p">,</span>
        <span class="n">alpha_s_estimator_param_list</span><span class="o">=</span><span class="n">alpha_s_estimator_param_list</span><span class="p">,</span>
        <span class="n">g_s_estimator_list</span><span class="o">=</span><span class="n">g_s_estimator_list</span><span class="p">,</span>
        <span class="n">g_s_estimator_param_list</span><span class="o">=</span><span class="n">g_s_estimator_param_list</span><span class="p">,</span>
        <span class="n">effect_strength_treatment</span><span class="o">=</span><span class="n">kappa_t</span><span class="p">,</span>
        <span class="n">effect_strength_outcome</span><span class="o">=</span><span class="n">kappa_y</span><span class="p">,</span>
        <span class="n">benchmark_common_causes</span><span class="o">=</span><span class="n">benchmark_common_causes</span><span class="p">,</span>
        <span class="n">frac_strength_treatment</span><span class="o">=</span><span class="n">frac_strength_treatment</span><span class="p">,</span>
        <span class="n">frac_strength_outcome</span><span class="o">=</span><span class="n">frac_strength_outcome</span><span class="p">,</span>
        <span class="n">theta_s</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">plugin_reisz</span><span class="o">=</span><span class="n">plugin_reisz</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">check_sensitivity</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot_estimate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analyzer</span></div>



<div class="viewcode-block" id="sensitivity_e_value">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.sensitivity_e_value">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_e_value</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
    <span class="n">estimate</span><span class="p">:</span> <span class="n">CausalEstimate</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">outcome_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">plot_estimate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EValueSensitivityAnalyzer</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">RegressionEstimator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;E-Value sensitivity analysis is currently only implemented RegressionEstimator.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The current implementation does not support effect modifiers&quot;</span><span class="p">)</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">EValueSensitivityAnalyzer</span><span class="p">(</span>
        <span class="n">estimate</span><span class="o">=</span><span class="n">estimate</span><span class="p">,</span>
        <span class="n">estimand</span><span class="o">=</span><span class="n">target_estimand</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">treatment_name</span><span class="o">=</span><span class="n">treatment_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">check_sensitivity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot_estimate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analyzer</span></div>



<div class="viewcode-block" id="sensitivity_simulation">
<a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.add_unobserved_common_cause.sensitivity_simulation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_simulation</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_estimand</span><span class="p">:</span> <span class="n">IdentifiedEstimand</span><span class="p">,</span>
    <span class="n">estimate</span><span class="p">:</span> <span class="n">CausalEstimate</span><span class="p">,</span>
    <span class="n">treatment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">outcome_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">kappa_t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kappa_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">confounders_effect_on_treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;binary_flip&quot;</span><span class="p">,</span>
    <span class="n">confounders_effect_on_outcome</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">frac_strength_treatment</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">frac_strength_outcome</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">plotmethod</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">_</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CausalRefutation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function attempts to add an unobserved common cause to the outcome and the treatment. At present, we have implemented the behavior for one dimensional behaviors for continuous</span>
<span class="sd">    and binary variables. This function can either take single valued inputs or a range of inputs. The function then looks at the data type of the input and then decides on the course of</span>
<span class="sd">    action.</span>

<span class="sd">    :param data: pd.DataFrame: Data to run the refutation</span>
<span class="sd">    :param target_estimand: IdentifiedEstimand: Identified estimand to run the refutation</span>
<span class="sd">    :param estimate: CausalEstimate: Estimate to run the refutation</span>
<span class="sd">    :param treatment_name: str: Name of the treatment</span>
<span class="sd">    :param outcome_name: str: Name of the outcome</span>
<span class="sd">    :param kappa_t: float, numpy.ndarray: Strength of the confounder&#39;s effect on treatment. When confounders_effect_on_treatment is linear,  it is the regression coefficient. When the confounders_effect_on_treatment is binary flip, it is the probability with which effect of unobserved confounder can invert the value of the treatment.</span>
<span class="sd">    :param kappa_y: float, numpy.ndarray: Strength of the confounder&#39;s effect on outcome. Its interpretation depends on confounders_effect_on_outcome and the simulation_method. When simulation_method is direct-simulation, for a linear effect it behaves like the regression coefficient and for a binary flip, it is the probability with which it can invert the value of the outcome.</span>
<span class="sd">    :param confounders_effect_on_treatment: str : The type of effect on the treatment due to the unobserved confounder. Possible values are [&#39;binary_flip&#39;, &#39;linear&#39;]</span>
<span class="sd">    :param confounders_effect_on_outcome: str : The type of effect on the outcome due to the unobserved confounder. Possible values are [&#39;binary_flip&#39;, &#39;linear&#39;]</span>
<span class="sd">    :param frac_strength_treatment: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on treatment. Defaults to 1.</span>
<span class="sd">    :param frac_strength_outcome: float: This parameter decides the effect strength of the simulated confounder as a fraction of the effect strength of observed confounders on outcome. Defaults to 1.</span>
<span class="sd">    :param plotmethod: string: Type of plot to be shown. If None, no plot is generated. This parameter is used only only when more than one treatment confounder effect values or outcome confounder effect values are provided. Default is &quot;colormesh&quot;. Supported values are &quot;contour&quot;, &quot;colormesh&quot; when more than one value is provided for both confounder effect value parameters; &quot;line&quot; when provided for only one of them.</span>

<span class="sd">    :return: CausalRefuter: An object that contains the estimated effect and a new effect and the name of the refutation used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kappa_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kappa_t</span> <span class="o">=</span> <span class="n">_infer_default_kappa_t</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">target_estimand</span><span class="p">,</span> <span class="n">treatment_name</span><span class="p">,</span> <span class="n">confounders_effect_on_treatment</span><span class="p">,</span> <span class="n">frac_strength_treatment</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">kappa_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kappa_y</span> <span class="o">=</span> <span class="n">_infer_default_kappa_y</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">target_estimand</span><span class="p">,</span> <span class="n">outcome_name</span><span class="p">,</span> <span class="n">confounders_effect_on_outcome</span><span class="p">,</span> <span class="n">frac_strength_outcome</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">kappa_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="p">):</span>  <span class="c1"># Deal with single value inputs</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">_include_confounders_effect</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">new_data</span><span class="p">,</span>
            <span class="n">confounders_effect_on_treatment</span><span class="p">,</span>
            <span class="n">treatment_name</span><span class="p">,</span>
            <span class="n">kappa_t</span><span class="p">,</span>
            <span class="n">confounders_effect_on_outcome</span><span class="p">,</span>
            <span class="n">outcome_name</span><span class="p">,</span>
            <span class="n">kappa_y</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">get_new_estimator_object</span><span class="p">(</span><span class="n">target_estimand</span><span class="p">)</span>
        <span class="n">new_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">new_data</span><span class="p">,</span>
            <span class="n">effect_modifier_names</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
            <span class="o">**</span><span class="n">new_estimator</span><span class="o">.</span><span class="n">_fit_params</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_estimator</span><span class="p">,</span> <span class="s2">&quot;_fit_params&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{},</span>
        <span class="p">)</span>
        <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
            <span class="n">new_data</span><span class="p">,</span>
            <span class="n">control_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
            <span class="n">treatment_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
            <span class="n">target_units</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span>
            <span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Add an Unobserved Common Cause&quot;</span>
        <span class="p">)</span>

        <span class="n">refute</span><span class="o">.</span><span class="n">new_effect_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_effect</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">refute</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Deal with multiple value inputs</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">kappa_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="p">):</span>  <span class="c1"># Deal with range inputs</span>
            <span class="c1"># Get a 2D matrix of values</span>
            <span class="c1"># x,y =  np.meshgrid(self.kappa_t, self.kappa_y) # x,y are both MxN</span>

            <span class="n">results_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">))</span>  <span class="c1"># Matrix to hold all the results of NxM</span>
            <span class="n">orig_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">)),</span>
                <span class="n">colour</span><span class="o">=</span><span class="n">CausalRefuter</span><span class="o">.</span><span class="n">PROGRESS_BAR_COLOR</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_progress_bar</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Refuting Estimates: &quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">)):</span>
                    <span class="n">new_data</span> <span class="o">=</span> <span class="n">_include_confounders_effect</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="n">orig_data</span><span class="p">,</span>
                        <span class="n">confounders_effect_on_treatment</span><span class="p">,</span>
                        <span class="n">treatment_name</span><span class="p">,</span>
                        <span class="n">kappa_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">confounders_effect_on_outcome</span><span class="p">,</span>
                        <span class="n">outcome_name</span><span class="p">,</span>
                        <span class="n">kappa_y</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">get_new_estimator_object</span><span class="p">(</span><span class="n">target_estimand</span><span class="p">)</span>
                    <span class="n">new_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                        <span class="n">new_data</span><span class="p">,</span>
                        <span class="n">effect_modifier_names</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">new_estimator</span><span class="o">.</span><span class="n">_fit_params</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_estimator</span><span class="p">,</span> <span class="s2">&quot;_fit_params&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{},</span>
                    <span class="p">)</span>
                    <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
                        <span class="n">new_data</span><span class="p">,</span>
                        <span class="n">control_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
                        <span class="n">treatment_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
                        <span class="n">target_units</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span>
                        <span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Add an Unobserved Common Cause&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">results_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span>  <span class="c1"># Populate the results</span>

            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect_array</span> <span class="o">=</span> <span class="n">results_matrix</span>
            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">results_matrix</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">results_matrix</span><span class="p">))</span>
            <span class="c1"># Store the values into the refute object</span>
            <span class="k">if</span> <span class="n">plotmethod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">refute</span>

            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

            <span class="n">oe</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">value</span>
            <span class="n">contour_levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">oe</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">oe</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">oe</span><span class="p">,</span> <span class="n">oe</span><span class="p">]</span>
            <span class="n">contour_levels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">results_matrix</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">results_matrix</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">plotmethod</span> <span class="o">==</span> <span class="s2">&quot;contour&quot;</span><span class="p">:</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">,</span> <span class="n">kappa_t</span><span class="p">,</span> <span class="n">results_matrix</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">contour_levels</span><span class="p">))</span>
                <span class="c1"># Adding a label on the contour line for the original estimate</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">trueeffect_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">levels</span> <span class="o">==</span> <span class="n">oe</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmt</span><span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">trueeffect_index</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;Estimated Effect&quot;</span>
                <span class="c1"># Label every other level using strings</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">trueeffect_index</span><span class="p">]],</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">plotmethod</span> <span class="o">==</span> <span class="s2">&quot;colormesh&quot;</span><span class="p">:</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">,</span> <span class="n">kappa_t</span><span class="p">,</span> <span class="n">results_matrix</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">contour_levels</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of Unobserved Common Cause&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value of Linear Constant on Treatment&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Value of Linear Constant on Outcome&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">refute</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">outcomes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">))</span>
            <span class="n">orig_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">)),</span>
                <span class="n">colour</span><span class="o">=</span><span class="n">CausalRefuter</span><span class="o">.</span><span class="n">PROGRESS_BAR_COLOR</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_progress_bar</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Refuting Estimates: &quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">_include_confounders_effect</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">orig_data</span><span class="p">,</span>
                    <span class="n">confounders_effect_on_treatment</span><span class="p">,</span>
                    <span class="n">treatment_name</span><span class="p">,</span>
                    <span class="n">kappa_t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">confounders_effect_on_outcome</span><span class="p">,</span>
                    <span class="n">outcome_name</span><span class="p">,</span>
                    <span class="n">kappa_y</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">get_new_estimator_object</span><span class="p">(</span><span class="n">target_estimand</span><span class="p">)</span>
                <span class="n">new_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                    <span class="n">new_data</span><span class="p">,</span>
                    <span class="n">effect_modifier_names</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">new_estimator</span><span class="o">.</span><span class="n">_fit_params</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_estimator</span><span class="p">,</span> <span class="s2">&quot;_fit_params&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{},</span>
                <span class="p">)</span>
                <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
                    <span class="n">new_data</span><span class="p">,</span>
                    <span class="n">control_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
                    <span class="n">treatment_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
                    <span class="n">target_units</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span>
                    <span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Add an Unobserved Common Cause&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">refute</span><span class="p">)</span>
                <span class="n">outcomes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span>  <span class="c1"># Populate the results</span>

            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect_array</span> <span class="o">=</span> <span class="n">outcomes</span>
            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">outcomes</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plotmethod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">refute</span>

            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kappa_t</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of Unobserved Common Cause&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Value of Linear Constant on Treatment&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Estimated Effect after adding the common cause&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">refute</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">outcomes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">))</span>
            <span class="n">orig_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">)),</span>
                <span class="n">colour</span><span class="o">=</span><span class="n">CausalRefuter</span><span class="o">.</span><span class="n">PROGRESS_BAR_COLOR</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">show_progress_bar</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Refuting Estimates: &quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">_include_confounders_effect</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">orig_data</span><span class="p">,</span>
                    <span class="n">confounders_effect_on_treatment</span><span class="p">,</span>
                    <span class="n">treatment_name</span><span class="p">,</span>
                    <span class="n">kappa_t</span><span class="p">,</span>
                    <span class="n">confounders_effect_on_outcome</span><span class="p">,</span>
                    <span class="n">outcome_name</span><span class="p">,</span>
                    <span class="n">kappa_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">get_new_estimator_object</span><span class="p">(</span><span class="n">target_estimand</span><span class="p">)</span>
                <span class="n">new_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
                    <span class="n">new_data</span><span class="p">,</span>
                    <span class="n">effect_modifier_names</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_effect_modifier_names</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">new_estimator</span><span class="o">.</span><span class="n">_fit_params</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_estimator</span><span class="p">,</span> <span class="s2">&quot;_fit_params&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{},</span>
                <span class="p">)</span>
                <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
                    <span class="n">new_data</span><span class="p">,</span>
                    <span class="n">control_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
                    <span class="n">treatment_value</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
                    <span class="n">target_units</span><span class="o">=</span><span class="n">estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">_target_units</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span>
                    <span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Add an Unobserved Common Cause&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">refute</span><span class="p">)</span>
                <span class="n">outcomes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span>  <span class="c1"># Populate the results</span>

            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect_array</span> <span class="o">=</span> <span class="n">outcomes</span>
            <span class="n">refute</span><span class="o">.</span><span class="n">new_effect</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">outcomes</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plotmethod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">refute</span>

            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kappa_y</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of Unobserved Common Cause&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Value of Linear Constant on Outcome&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Estimated Effect after adding the common cause&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">refute</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022, PyWhy contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B139P18WHM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B139P18WHM');
</script>
    <title>dowhy.causal_refuters.placebo_treatment_refuter &#8212; DoWhy  documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">DoWhy  documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../getting_started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../example_notebooks/nb_index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../dowhy.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../code_repo.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
      <div class="navbar-end-item">
        
<div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        main-branch
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
        <dl>
            <dt>Releases</dt>
            <!-- hard-coding the old versions, as no further old version will be added -->
            <!-- It would be nice if this opened the same page in an older version, but that seems to be overkill
                 right now. Therefore defaulting to the starting page (index). -->
            <dd><a href="/dowhy/v0.8/index.html">v0.8</a></dd>
            <dd><a href="/dowhy/v0.7.1/index.html">v0.7.1</a></dd>
            <dd><a href="/dowhy/v0.7/index.html">v0.7</a></dd>
            <dd><a href="/dowhy/v0.6/index.html">v0.6</a></dd>
            <dd><a href="/dowhy/v0.5.1/index.html">v0.5.1</a></dd>
            <dd><a href="/dowhy/v0.5/index.html">v0.5</a></dd>
            <dd><a href="/dowhy/v0.4/index.html">v0.4</a></dd>
            <dd><a href="/dowhy/v0.2/index.html">v0.2</a></dd>
            <dd><a href="/dowhy/v0.1.1-alpha/index.html">v0.1.1-alpha</a></dd>
            <dd><a href="/dowhy/v0.1-alpha/index.html">v0.1-alpha</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="placebo_treatment_refuter.html">main</a></dd>
        </dl>
    </div>
</div>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <h1>Source code for dowhy.causal_refuters.placebo_treatment_refuter</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>


<span class="kn">from</span> <span class="nn">dowhy.causal_refuter</span> <span class="kn">import</span> <span class="n">CausalRefutation</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_refuter</span> <span class="kn">import</span> <span class="n">CausalRefuter</span>
<span class="kn">from</span> <span class="nn">dowhy.causal_estimator</span> <span class="kn">import</span> <span class="n">CausalEstimator</span><span class="p">,</span> <span class="n">CausalEstimate</span>
<span class="kn">from</span> <span class="nn">dowhy.utils.api</span> <span class="kn">import</span> <span class="n">parse_state</span>

<div class="viewcode-block" id="PlaceboTreatmentRefuter"><a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.placebo_treatment_refuter.PlaceboTreatmentRefuter">[docs]</a><span class="k">class</span> <span class="nc">PlaceboTreatmentRefuter</span><span class="p">(</span><span class="n">CausalRefuter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Refute an estimate by replacing treatment with a randomly-generated placebo variable.</span>

<span class="sd">    Supports additional parameters that can be specified in the refute_estimate() method. For joblib-related parameters (n_jobs, verbose), please refer to the joblib documentation for more details (https://joblib.readthedocs.io/en/latest/generated/joblib.Parallel.html).</span>

<span class="sd">    :param placebo_type: Default is to generate random values for the treatment. If placebo_type is &quot;permute&quot;, then the original treatment values are permuted by row.</span>
<span class="sd">    :type placebo_type: str, optional</span>

<span class="sd">    :param num_simulations: The number of simulations to be run, which is ``CausalRefuter.DEFAULT_NUM_SIMULATIONS`` by default</span>
<span class="sd">    :type num_simulations: int, optional</span>

<span class="sd">    :param random_state: The seed value to be added if we wish to repeat the same random behavior. If we want to repeat the same behavior we push the same seed in the psuedo-random generator.</span>
<span class="sd">    :type random_state: int, RandomState, optional</span>

<span class="sd">    :param n_jobs: The maximum number of concurrently running jobs. If -1 all CPUs are used. If 1 is given, no parallel computing code is used at all (this is the default).</span>
<span class="sd">    :type n_jobs: int, optional</span>

<span class="sd">    :param verbose: The verbosity level: if non zero, progress messages are printed. Above 50, the output is sent to stdout. The frequency of the messages increases with the verbosity level. If it more than 10, all iterations are reported. The default is 0.</span>
<span class="sd">    :type verbose: int, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default value of the p value taken for the distribution</span>
    <span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="c1"># Number of Trials: Number of cointosses to understand if a sample gets the treatment</span>
    <span class="n">DEFAULT_NUMBER_OF_TRIALS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Mean of the Normal Distribution</span>
    <span class="n">DEFAULT_MEAN_OF_NORMAL</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Standard Deviation of the Normal Distribution</span>
    <span class="n">DEFAULT_STD_DEV_OF_NORMAL</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;placebo_type&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">=</span> <span class="s2">&quot;Random Data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;num_simulations&quot;</span><span class="p">,</span><span class="n">CausalRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUM_SIMULATIONS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;random_state&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PlaceboTreatmentRefuter.refute_estimate"><a class="viewcode-back" href="../../../dowhy.causal_refuters.html#dowhy.causal_refuters.placebo_treatment_refuter.PlaceboTreatmentRefuter.refute_estimate">[docs]</a>    <span class="k">def</span> <span class="nf">refute_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># only permute is supported for iv methods</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">!=</span> <span class="s2">&quot;permute&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Only placebo_type=&#39;&#39;permute&#39;&#39; is supported for creating placebo for instrumental variable estimation methods&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only placebo_type=&#39;&#39;permute&#39;&#39; is supported for creating placebo for instrumental variable estimation methods.&quot;</span><span class="p">)</span>

        <span class="c1"># We need to change the identified estimand</span>
        <span class="c1"># We make a copy as a safety measure, we don&#39;t want to change the</span>
        <span class="c1"># original DataFrame</span>
        <span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="p">)</span>
        <span class="n">identified_estimand</span><span class="o">.</span><span class="n">treatment_variable</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;placebo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="n">identified_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">identified_estimand</span><span class="o">.</span><span class="n">instrumental_variables</span><span class="p">]</span>
            <span class="c1"># For IV methods, the estimating_instrument_names should also be</span>
            <span class="c1"># changed. So we change it inside the estimate and then restore it</span>
            <span class="c1"># back at the end of this method.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;iv_instrument_name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">])]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Refutation over </span><span class="si">{}</span><span class="s2"> simulated datasets of </span><span class="si">{}</span><span class="s2"> treatment&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span>
                        <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="n">num_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">treatment_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Extract the name of the treatment variable</span>
        <span class="n">type_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtypes</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">refute_once</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placebo_type</span> <span class="o">==</span> <span class="s2">&quot;permute&quot;</span><span class="p">:</span>
                <span class="n">permuted_idx</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">permuted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">permuted_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">new_treatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">permuted_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
                    <span class="n">new_instruments_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">permuted_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">new_instruments_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_instruments_values</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;placebo_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">estimating_instrument_names</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;float&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Normal Distribution with Mean:</span><span class="si">{}</span><span class="s2"> and Variance:</span><span class="si">{}</span><span class="s2">&quot;</span>
                                     <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_MEAN_OF_NORMAL</span>
                                     <span class="p">,</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_STD_DEV_OF_NORMAL</span><span class="p">)</span>
                                     <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span><span class="o">*</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_STD_DEV_OF_NORMAL</span> <span class="o">+</span> \
                                    <span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_MEAN_OF_NORMAL</span>

                <span class="k">elif</span> <span class="s1">&#39;bool&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Binomial Distribution with </span><span class="si">{}</span><span class="s2"> trials and </span><span class="si">{}</span><span class="s2"> probability of success&quot;</span>
                                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_TRIALS</span>
                                    <span class="p">,</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span><span class="p">)</span>
                                    <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_TRIALS</span><span class="p">,</span>
                                                       <span class="n">PlaceboTreatmentRefuter</span><span class="o">.</span><span class="n">DEFAULT_PROBABILITY_OF_BINOMIAL</span><span class="p">,</span>
                                                       <span class="n">num_rows</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;int&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Discrete Uniform Distribution lying between </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    <span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                                      <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                                                      <span class="n">size</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>

                <span class="k">elif</span> <span class="s1">&#39;category&#39;</span> <span class="ow">in</span> <span class="n">type_dict</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span>
                    <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">treatment_name</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using a Discrete Uniform Distribution with the following categories:</span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>
                    <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>
                    <span class="n">new_treatment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

            <span class="c1"># Create a new column in the data by the name of placebo</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">placebo</span><span class="o">=</span><span class="n">new_treatment</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_instruments_df</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Sanity check the data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">new_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">new_estimator</span> <span class="o">=</span> <span class="n">CausalEstimator</span><span class="o">.</span><span class="n">get_estimator_object</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">identified_estimand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="p">)</span>
            <span class="n">new_effect</span> <span class="o">=</span> <span class="n">new_estimator</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">new_effect</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Run refutation in parallel</span>
        <span class="n">sample_estimates</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span>
            <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">,</span> 
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span>
        <span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">refute_once</span><span class="p">)()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_simulations</span><span class="p">))</span>
        <span class="n">sample_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_estimates</span><span class="p">)</span>

        <span class="c1"># Restoring the value of iv_instrument_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_estimand</span><span class="o">.</span><span class="n">identifier_method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;iv&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;iv_instrument_name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;placebo_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">parse_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;method_params&quot;</span><span class="p">][</span><span class="s2">&quot;iv_instrument_name&quot;</span><span class="p">])]</span>
        <span class="n">refute</span> <span class="o">=</span> <span class="n">CausalRefutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_estimates</span><span class="p">),</span>
                                  <span class="n">refutation_type</span><span class="o">=</span><span class="s2">&quot;Refute: Use a Placebo Treatment&quot;</span><span class="p">)</span>

        <span class="c1"># Note: We hardcode the estimate value to ZERO as we want to check if it falls in the distribution of the refuter</span>
        <span class="c1"># Ideally we should expect that ZERO should fall in the distribution of the effect estimates as we have severed any causal</span>
        <span class="c1"># relationship between the treatment and the outcome.</span>
        <span class="n">dummy_estimator</span> <span class="o">=</span> <span class="n">CausalEstimate</span><span class="p">(</span>
                <span class="n">estimate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">control_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">control_value</span><span class="p">,</span>
                <span class="n">treatment_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">treatment_value</span><span class="p">,</span>
                <span class="n">target_estimand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">target_estimand</span><span class="p">,</span>
                <span class="n">realized_estimand_expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate</span><span class="o">.</span><span class="n">realized_estimand_expr</span><span class="p">)</span>

        <span class="n">refute</span><span class="o">.</span><span class="n">add_significance_test_results</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_significance</span><span class="p">(</span><span class="n">dummy_estimator</span><span class="p">,</span> <span class="n">sample_estimates</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">refute</span><span class="o">.</span><span class="n">add_refuter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refute</span></div></div>
</pre></div>

              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PyWhy contributors.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.2.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>